---
title: "SEACAR Oyster Analyses - Reference Information"
author: "Stephen R. Durham"
date: "4/22/2021"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    theme: "cerulean"
    code_folding: "hide"
editor_options: 
  chunk_output_type: console
---

<style type="text/css">
div.main-container {
  max-width: 1800px;
  margin-left: auto;
  margin-right: auto;
}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
#knitr::opts_chunk$set(include = FALSE)
library(Rmisc)
library(lubridate)
library(tidyverse)
library(ggplot2)
library(here)
library(sf)
library(mapview)
library(quantreg)
library(rcompanion)
library(data.table)
library(kableExtra)
library(DT)
library(nlme)
library(brms)
library(modelr)
library(tidybayes)
library(gamlss)
library(doFuture)
library(tictoc)
library(doRNG)
library(nlme)
library(lme4)
library(piecewiseSEM)
library(ggthemes)
library(openxlsx)
library(sp)


#oysterraw_old <- fread(here::here("All_Parameters_but_Hectares_2020-Sep-14.csv"))

#Check for rows with no data and remove them.
#length(subset(oysterraw_old, is.na(oysterraw_old$Density_m2) & is.na(oysterraw_old$PercentLive_pct) & 
#                is.na(oysterraw_old$ShellHeight_mm) & is.na(oysterraw_old$Number_of_Oysters_Counted_Total_Count) & 
#                is.na(oysterraw_old$Number_of_Oysters_Counted_Live_Count) & 
#                is.na(oysterraw_old$Number_of_Oysters_Counted_Dead_Count) & 
#                is.na(oysterraw_old$ReefHeight_mm))$ProgramID)

#oysterraw_old <- subset(oysterraw_old, !is.na(oysterraw_old$Density_m2) | !is.na(oysterraw_old$PercentLive_pct) | 
#                      !is.na(oysterraw_old$ShellHeight_mm) | 
#                      !is.na(oysterraw_old$Number_of_Oysters_Counted_Total_Count) | 
#                      !is.na(oysterraw_old$Number_of_Oysters_Counted_Live_Count) | 
#                      !is.na(oysterraw_old$Number_of_Oysters_Counted_Dead_Count) | 
#                      !is.na(oysterraw_old$ReefHeight_mm))

oysterraw <- fread(here::here("All_Parameters_but_Hectares_2021-Feb-04.csv"))
#setnames(oysterraw, c("Density_#/m2", "Percent Live_%", "Shell Height_mm", "Number of Oysters Counted - Total_Count", "Number of Oysters Counted - #Live_Count", "Number of Oysters Counted - Dead_Count", "Reef Height_mm"), c("Density_m2", "PercentLive_pct", "ShellHeight_mm", #"Number_of_Oysters_Counted_Total_Count", "Number_of_Oysters_Counted_Live_Count", "Number_of_Oysters_Counted_Dead_Count", "ReefHeight_mm"))

#Check for rows with no data and remove them.
length(subset(oysterraw, is.na(oysterraw$Density_m2) & is.na(oysterraw$PercentLive_pct) & 
                is.na(oysterraw$ShellHeight_mm) & is.na(oysterraw$Number_of_Oysters_Counted_Total_Count) & 
                is.na(oysterraw$Number_of_Oysters_Counted_Live_Count) & 
                is.na(oysterraw$Number_of_Oysters_Counted_Dead_Count) & 
                is.na(oysterraw$ReefHeight_mm))$ProgramID)

oysterraw <- subset(oysterraw, !is.na(oysterraw$Density_m2) | !is.na(oysterraw$PercentLive_pct) | 
                      !is.na(oysterraw$ShellHeight_mm) | 
                      !is.na(oysterraw$Number_of_Oysters_Counted_Total_Count) | 
                      !is.na(oysterraw$Number_of_Oysters_Counted_Live_Count) | 
                      !is.na(oysterraw$Number_of_Oysters_Counted_Dead_Count) | 
                      !is.na(oysterraw$ReefHeight_mm))
setDT(oysterraw)

#Fix some non-unique quadrat IDs for ID4012
oysterraw[DataFileName == "Data_4012A_Final.csv", ReefIdentifier := ProgramLocationID]
oysterraw[DataFileName == "Data_4012E_Final.csv", QuadIdentifier := ProgramLocationID]
oysterraw[DataFileName == "Data_4012C_Final.csv", QuadIdentifier := ProgramLocationID]

#Fix HabitatClassification for program 4012
#Fix4012HC <- oysterraw[ProgramID == 4012, ]
#Fix4012HC <- Fix4012HC[ReefIdentifier %like% "_Ref", HabitatClassification := "Natural"]
#Fix4012HC <- Fix4012HC[ReefIdentifier %like% "_C", HabitatClassification := "Natural"]
#no4012 <- subset(oysterraw, oysterraw$ProgramID != 4012)
#oysterraw <- rbind(Fix4012HC, no4012)

#Remove ProgramLocationIDs for reef elevation values that ended up in the ShellHeight_mm column.
#oysterraw <- oysterraw[grepl('ReefElev', ProgramLocationID) == FALSE, ]


```


```{r eval=FALSE, include=FALSE}
#Replace data for ID5035 with updated HOBS data

#Set up the new HOBS data file to look like the combined table
newhobsdat <- fread(here::here('ID5035_HOBS_MasterDataFile_Invoice6_final_inc14C.csv'))
newhobsdat_formerge <- copy(newhobsdat[, RowID := as.integer()])
newhobsdat_formerge[, ProgramID := 5035]
newhobsdat_formerge[, ProgramName := "Historical Oyster Body Size (HOBS) Study"]
setnames(newhobsdat_formerge, "PRI_station", "ProgramLocationID")
setnames(newhobsdat_formerge, "Sample_code", "QuadIdentifier")
newhobsdat_formerge[, ReefIdentifier := substring(QuadIdentifier, 1, nchar(QuadIdentifier) - 4)]
setnames(newhobsdat_formerge, "Sample_median_age", "LiveDate")
newhobsdat_formerge[, LiveDate_Qualifier := "Estimate"]
setnames(newhobsdat_formerge, "Sample_minimum_age", "LiveDate_MinEstDate")
setnames(newhobsdat_formerge, "Sample_maximum_age", "LiveDate_MaxEstDate")
newhobsdat_formerge[, GISUniqueID := as.logical()]
newhobsdat_formerge[, Collection_time := substring(Collection_time, 1, nchar(Collection_time) - 1)]
newhobsdat_formerge[, SampleDate := paste0(Collection_date, " ", substring(Collection_time, 1, nchar(Collection_time) - 3))]
newhobsdat_formerge[, Year := substring(Collection_date, nchar(Collection_date) - 3, nchar(Collection_date))]
newhobsdat_formerge[, Month := ifelse(Collection_date %like% "9/", substring(Collection_date, 1, 1), substring(Collection_date, 1, 2))]
newhobsdat_formerge[Locality == "Lone Cabbage", ManagedAreaName := "Big Bend Seagrasses"][Locality == "Guana River" | Locality == "Matanzas River" | Locality == "Pellicer Creek", ManagedAreaName := "Guana Tolomato Matanzas NERR"][Locality == "Jack Island/Wildcat Cove", ManagedAreaName := "Indian River-Vero Beach to Ft. Pierce"][Locality == "Lemon Bay", ManagedAreaName := "Lemon Bay"][Locality == "Big Hickory" | Locality == "Hendry/Mullock Creeks" | Locality == "New Pass", ManagedAreaName := "Estero Bay"][Locality == "Goose Island/East Cove" | Locality == "Little St. George Island", ManagedAreaName := "Apalachicola NERR"]
newhobsdat_formerge[ManagedAreaName == "Estero Bay" | ManagedAreaName == "Lemon Bay", Region := "SW"][ManagedAreaName == "Apalachicola NERR" | ManagedAreaName == "Big Bend Seagrasses", Region := "NW"][ManagedAreaName == "Guana Tolomato Matanzas NERR" | ManagedAreaName == "Indian River-Vero Beach to Ft. Pierce", Region := "NE"]
newhobsdat_formerge[, SurveyMethod := "Transect Quadrat"]
newhobsdat_formerge[, PercentLiveMethod := as.character()]
newhobsdat_formerge[, HabitatClassification := "Natural"]
newhobsdat_formerge[, MinimumSizeMeasured_mm := 20]
newhobsdat_formerge[, NumberMeasured_n := "ALL"]
newhobsdat_formerge[, QuadSize_m2 := 0.0625]
newhobsdat_formerge[, MADup := 1]
newhobsdat_formerge[, DataFileName := "ID5035_HOBS_MasterDataFile_Invoice6_final_inc14C.csv"]
newhobsdat_formerge[, Density_m2 := as.numeric()]
newhobsdat_formerge[, PercentLive_pct := as.numeric()]
setnames(newhobsdat_formerge, "LV_H_mm", "ShellHeight_mm")
newhobsdat_formerge[, Number_of_Oysters_Counted_Total_Count := as.integer()]
newhobsdat_formerge[, Number_of_Oysters_Counted_Live_Count := as.integer()]
newhobsdat_formerge[, Number_of_Oysters_Counted_Dead_Count := as.integer()]
newhobsdat_formerge[, ReefHeight_mm := as.numeric()]

#APsinNERRs_locs <- c("Little St. George Island", "Guana River", "Pellicer Creek")
APsinNERRs_locs <- c("Little St. George Island", "Guana River")

#newhobsdat_formerge_APsinNERRs <- newhobsdat_formerge[Locality %in% APsinNERRs_locs, ][, MADup := 2][Locality == "Little St. George Island", ManagedAreaName := "Apalachicola Bay"][Locality == "Guana River", ManagedAreaName := "Guana River Marsh"][Locality == "Pellicer Creek", ManagedAreaName := "Pellicer Creek"]

#newhobsdat_formerge_APsinNERRs <- copy(newhobsdat_formerge[Locality %in% APsinNERRs_locs, MADup := 2])
newhobsdat_formerge_APsinNERRs <- subset(newhobsdat_formerge, newhobsdat_formerge$Locality %in% APsinNERRs_locs)
newhobsdat_formerge_APsinNERRs[, MADup := 2]
newhobsdat_formerge_APsinNERRs[Locality == "Little St. George Island", ManagedAreaName := "Apalachicola Bay"]
newhobsdat_formerge_APsinNERRs[Locality == "Guana River", ManagedAreaName := "Guana River Marsh"]
HOBSdat_n <- subset(oysterraw, oysterraw$ProgramID == 5035)$ObsIndex
newhobsdat_formerge[, ObsIndex := c(HOBSdat_n, 1601713:1610969)]
ObsInd_APsinNERRs <- subset(newhobsdat_formerge, newhobsdat_formerge$Locality %in% APsinNERRs_locs)$ObsIndex
newhobsdat_formerge_APsinNERRs[, ObsIndex := ObsInd_APsinNERRs]


newhobsdat_formerge <- rbind(newhobsdat_formerge, newhobsdat_formerge_APsinNERRs)

combinedtablecols <- c("RowID", "ProgramID", "ProgramName", "ProgramLocationID", "QuadIdentifier", "ReefIdentifier", "LiveDate", "LiveDate_Qualifier", "LiveDate_MinEstDate", "LiveDate_MaxEstDate", "GISUniqueID", "SampleDate", "Year", "Month", "ManagedAreaName", "Region", "SurveyMethod", "PercentLiveMethod", "HabitatClassification", "MinimumSizeMeasured_mm", "NumberMeasured_n", "QuadSize_m2", "MADup", "DataFileName", "Density_m2", "PercentLive_pct", "ShellHeight_mm", "Number_of_Oysters_Counted_Total_Count", "Number_of_Oysters_Counted_Live_Count", "Number_of_Oysters_Counted_Dead_Count", "ReefHeight_mm", "ObsIndex")

newhobsdat_formerge2 <- newhobsdat_formerge[, ..combinedtablecols]
newhobsdat_formerge2 <- subset(newhobsdat_formerge2, !is.na(newhobsdat_formerge2$ShellHeight_mm))

oysterraw_no5035 <- oysterraw[ProgramID != 5035, ]
oysterraw <- rbind(oysterraw_no5035, newhobsdat_formerge2)
```


***

# Oyster method metadata

<br>

[Click here to view the oyster method metadata document.](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7B4AEEE00D-652A-4A11-8FA5-EDADC4A89D62%7D&file=OysterMethodMetadata_12032020.xlsx&action=default&mobileredirect=true)

<!-- ```{r} -->
<!-- mm <- fread(here::here("SEACAR_Oyster_MethodsMetadata_2020-10-26.csv")) -->
<!-- DT::datatable(mm, filter = 'top', options = list( -->
<!--   autoWidth = TRUE,  -->
<!--   columnDefs = list(list(width = '200px', targets = c(2, 12, 15, 16, 17, 18)), -->
<!--                     list(width = '50px', targets = c(0)), -->
<!--                     list(width = '300px', targets = c(11))), -->
<!--   scrollX = TRUE,  -->
<!--   headerCallback = DT::JS( -->
<!--     "function(thead) {", -->
<!--     "  $(thead).css('font-size', '85%');", -->
<!--     "}" -->
<!--   )), rownames = FALSE) %>% -->
<!--   DT::formatStyle(columns = c(0:18), fontSize = '80%') -->
<!-- ``` -->

<br><br>

***

# ReefID crosswalk map

<br>

Oyster reef sample locations in relation to mapped reefs by FWC. Reef polygons from FWC layer have been clipped to include only those that intersect with RCP managed areas. Grey sample locations are those that did not match to one of the oyster reef polygons. 

<br>

Click the link below to go to a SharePoint preview page for the map file; click the "Download" button on the menu at the top of the screen. Once the file downloads, it can be opened in any web browser.

[Click here to download a map of oyster reef sample locations in relation to mapped reefs by FWC..](https://floridadep.sharepoint.com/:u:/g/fco/seacar/seacar_expert_team/EWfTghKj7VNHjsEM5aQxVIcBbZtRwhl7um36t0ts73iZxQ)

<!-- ```{r Reef-crosswalk-map-only-no-buffer, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"} -->
<!-- othernerrs <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/othernerrs.rds')) -->
<!-- GTMnew <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/GTMnew.rds')) -->
<!-- aps <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/aps.rds')) -->
<!-- oysamplelocs_m <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/oysamplelocs_m.rds')) -->
<!-- fwcoymap_m_rcp <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/fwcoymap_m_rcp.rds')) -->
<!-- reefcrosswalk_rcp <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/reefcrosswalk_rcp.rds')) -->
<!-- GTMRegions <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/GTMRegions.rds')) -->

<!-- mapview(othernerrs, color = "dark grey", col.regions = "dark grey", alpha.regions = 0, layer.name = "Apalachicola NERR and Rookery Bay NERR") + -->
<!--   mapview(GTMnew, color = "dark grey", col.regions = "dark grey", alpha.regions = 0, layer.name = "Guana Tolomato Matanzas NERR") + -->
<!--   mapview(aps, color = "blue", col.regions = "blue", alpha.regions = 0, layer.name = "Florida Aquatic Preserves") + -->
<!--   mapview(GTMRegions, alpha.regions = 0.15, layer.name = "GTM NERR Regions") + -->
<!--   mapview(fwcoymap_m_rcp, zcol = 'match', burst = TRUE, hide = TRUE, layer.name = "Oyster reefs") + -->
<!--   mapview(oysamplelocs_m, col.regions = "grey", layer.name = "All oyster samples") + -->
<!--   mapview(reefcrosswalk_rcp, zcol = 'match_ind', burst = TRUE, hide = TRUE, layer.name = "Oyster analysis samples") -->

<!-- ``` -->

```{r Load-oysterraw-rds, echo=TRUE, message=FALSE, warning=FALSE}
oysterraw <- readRDS(here::here("oysterraw_2021-02-09_wRegions.rds"))
oysterraw[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
subtidal <- c(4044, 5007, 5071, 5073)
oysterraw[, Subtidal := ifelse(ProgramID %in% subtidal, 1, 0)]
oysterraw[, Subtidal := as.logical(Subtidal)]
oysterraw[!is.na(ShellHeight_mm), SHIndex := ObsIndex]
oysterraw[!is.na(Density_m2), DensIndex := ObsIndex]
oysterraw[!is.na(PercentLive_pct), PctIndex := ObsIndex]
oysterraw[!is.na(Number_of_Oysters_Counted_Total_Count), NTotIndex := ObsIndex]
oysterraw[!is.na(Number_of_Oysters_Counted_Live_Count), NLiveIndex := ObsIndex]
oysterraw[!is.na(Number_of_Oysters_Counted_Dead_Count), NDeadIndex := ObsIndex]

#Add in NumberMeasured_n value for ID5070 and ID5072; correct reefIDcrosswalk for ID5072
oysterraw[ProgramID == 5070, NumberMeasured_n := "ALL"]
oysterraw[ProgramID == 5072, NumberMeasured_n := "ALL"]
oysterraw[ProgramID == 5072, reefIDcrosswalk := "Unknown reef"]

#Other minor fixes
oysterraw[ProgramID == "5035", SampleDate := paste0(SampleDate, ":00")]
oysterraw[ProgramLocationID == "8859", SampleDate := "9/5/2018 19:28:00"]
LBs <- c("LB_R1", "LB_R2", "LB_R3")
oysterraw[ReefIdentifier %in% LBs, Month := "10"]

```

<br><br>

# All Sample Dates

```{r Indicator-data-subsets, echo=TRUE, message=FALSE, warning=FALSE}
# Separate oyster data into broad categories by indicator

#Reformat dataframe so that metadata rows are not duplicated for each data column. Based on solution posted here: https://stackoverflow.com/questions/54132853/how-to-collapse-a-dataframe-with-duplicate-ids-and-varying-missing-values-per-id

#oysterraw2 <- oysterraw[, c(2:32)] %>% 
#  dplyr::group_by(ProgramID, ProgramName, ProgramLocationID, QuadIdentifier, ReefIdentifier, LiveDate, 
#                  LiveDate_Qualifier, LiveDate_MinEstDate, LiveDate_MaxEstDate, GISUniqueID, SampleDate, 
#                  Year, Month, ManagedAreaName, Region, SurveyMethod, PercentLiveMethod, 
#                  HabitatClassification, MinimumSizeMeasured_mm, NumberMeasured_n, QuadSize_m2, MADup, 
#                  DataFileName, reefIDcrosswalk) %>%
#  tidyr::fill(Density_m2, PercentLive_pct, ShellHeight_mm, Number_of_Oysters_Counted_Total_Count, 
#              Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count, ReefHeight_mm)%>%
#  tidyr::fill(Density_m2, PercentLive_pct, ShellHeight_mm, Number_of_Oysters_Counted_Total_Count, 
#              Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count, ReefHeight_mm, 
#              .direction = 'up') %>%
#  dplyr::distinct()
#write.csv(oysterraw2, here::here("All_Parameters_but_Hectares_2020-Oct-06_noNA_srdedit.csv"))

#Create data table of shell heights
#oysterraw_sh <- oysterraw[, c(2:24, 27, 32:35)] %>%
oysterraw_sh <- oysterraw[, c("ProgramID", "ProgramName", "ProgramLocationID", "QuadIdentifier", "ReefIdentifier", "LiveDate", "LiveDate_Qualifier", "LiveDate_MinEstDate", "LiveDate_MaxEstDate", "GISUniqueID", "SampleDate", "Year", "Month", "ManagedAreaName", "Region.x", "SurveyMethod", "HabitatClassification", "MinimumSizeMeasured_mm", "NumberMeasured_n", "QuadSize_m2", "MADup", "DataFileName", "ShellHeight_mm", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal", "SHIndex")] %>%
            dplyr::group_by(ProgramID, ProgramName, ProgramLocationID, QuadIdentifier, ReefIdentifier, 
                            LiveDate, LiveDate_Qualifier, LiveDate_MinEstDate, LiveDate_MaxEstDate, 
                            GISUniqueID, SampleDate, Year, Month, ManagedAreaName, Region.x, SurveyMethod, 
                            HabitatClassification, MinimumSizeMeasured_mm, NumberMeasured_n, QuadSize_m2, 
                            MADup, DataFileName, reefIDcrosswalk, Region.y, MA_plotlab, Subtidal) %>%
            tidyr::fill(ShellHeight_mm, SHIndex) %>%
            tidyr::fill(ShellHeight_mm, SHIndex, .direction = 'up') %>%
            dplyr::distinct()
oysterraw_sh <- subset(oysterraw_sh, !is.na(oysterraw_sh$ShellHeight_mm) | !is.na(oysterraw_sh$SHIndex))


#oysterraw_old_sh <- oysterraw_old[, c(2:24,27)] %>%
#            dplyr::group_by(ProgramID, ProgramName, ProgramLocationID, QuadIdentifier, ReefIdentifier, 
#                            LiveDate, LiveDate_Qualifier, LiveDate_MinEstDate, LiveDate_MaxEstDate, 
#                            GISUniqueID, SampleDate, Year, Month, ManagedAreaName, Region, SurveyMethod, 
#                            PercentLiveMethod, HabitatClassification, MinimumSizeMeasured_mm, 
#                            NumberMeasured_n, QuadSize_m2, MADup, DataFileName) %>%
#            tidyr::fill(ShellHeight_mm) %>%
#            tidyr::fill(ShellHeight_mm, .direction = 'up') %>%
#            dplyr::distinct()
#oysterraw_old_sh <- subset(oysterraw_old_sh, !is.na(oysterraw_old_sh$ShellHeight_mm))


#Create data table of density and counts
#oysterraw_den <- oysterraw[, c(2:6, 11:17, 19, 22:23, 25, 28:30, 32:35)]
oysterraw_den <- oysterraw[, c("ProgramID", "ProgramName", "ProgramLocationID", "QuadIdentifier", "ReefIdentifier", "GISUniqueID", "SampleDate", "Year", "Month", "ManagedAreaName", "Region.x", "SurveyMethod", "HabitatClassification", "QuadSize_m2", "MADup", "Density_m2", "Number_of_Oysters_Counted_Total_Count", "Number_of_Oysters_Counted_Live_Count", "Number_of_Oysters_Counted_Dead_Count", "DensIndex", "NTotIndex", "NLiveIndex", "NDeadIndex", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal")]
oysterraw_den <- unique(oysterraw_den)
oysterraw_den <- oysterraw_den %>% 
                     dplyr::group_by(ProgramID, ProgramName, ProgramLocationID, QuadIdentifier, 
                                     ReefIdentifier, GISUniqueID, SampleDate, Year, Month, ManagedAreaName,
                                     Region.x, SurveyMethod, HabitatClassification, QuadSize_m2, MADup, reefIDcrosswalk, 
                                     Region.y, MA_plotlab, Subtidal) %>%
                     tidyr::fill(Density_m2, Number_of_Oysters_Counted_Total_Count, 
                                 Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count,
                                 DensIndex, NTotIndex, NLiveIndex, NDeadIndex) %>%
                     tidyr::fill(Density_m2, Number_of_Oysters_Counted_Total_Count, 
                                 Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count, 
                                 DensIndex, NTotIndex, NLiveIndex, NDeadIndex, .direction = 'up') %>%
                     dplyr::distinct()



oysterraw_den <- subset(oysterraw_den, !is.na(oysterraw_den$Density_m2) |
                             !is.na(oysterraw_den$Number_of_Oysters_Counted_Total_Count) | 
                             !is.na(oysterraw_den$Number_of_Oysters_Counted_Live_Count) | 
                             !is.na(oysterraw_den$Number_of_Oysters_Counted_Dead_Count) |
                             !is.na(oysterraw_den$DensIndex) | !is.na(oysterraw_den$NTotIndex) |
                             !is.na(oysterraw_den$NLiveIndex) | !is.na(oysterraw_den$NDeadIndex))


#4/12/2021 - Adding in updated raw data for ID972 from "All_Parameters_but_Hectares-2021-Mar-12.csv" because it has MADup duplication issues that prevent me from running the script with it from the beginning.

#Produce the new 972 data subset file.
# new972 <- fread(here::here("All_Parameters_but_Hectares-2021-Mar-12.csv"))
# setnames(new972, "Region", "Region.x")
# new972 <- new972[ProgramID == 972, ]
# new972[, `:=` (reefIDcrosswalk = character(), Region.y = character(), MA_plotlab = character(), Subtidal = logical(), SHIndex = integer(), DensIndex = integer(), PctIndex = integer(), NTotIndex = integer(), NLiveIndex = integer(), NDeadIndex = integer())]
# new972[, LiveDate_MinEstDate := as.numeric(LiveDate_MinEstDate)]
# new972[, LiveDate_MaxEstDate := as.numeric(LiveDate_MaxEstDate)]
# new972[, Year := as.character(Year)]
# new972[, Month := as.character(Month)]
# ColsFornew972 <- setdiff(colnames(oysterraw), colnames(new972))
# ColsFornew972 <- append(ColsFornew972, "ProgramLocationID")
# DatFornew972 <- oysterraw[, ..ColsFornew972]
# new972 <- merge(new972, DatFornew972, by = "ProgramLocationID")
# 
# new972_den <- new972[, c("ProgramID", "ProgramName", "ProgramLocationID", "QuadIdentifier", "ReefIdentifier", "GISUniqueID", "SampleDate", "Year", "Month", "ManagedAreaName", "Region.x", "SurveyMethod", "HabitatClassification", "QuadSize_m2", "MADup", "Density_m2", "Number_of_Oysters_Counted_Total_Count", "Number_of_Oysters_Counted_Live_Count", "Number_of_Oysters_Counted_Dead_Count", "DensIndex", "NTotIndex", "NLiveIndex", "NDeadIndex", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal")]
# new972_den <- unique(new972_den)
# new972_den <- new972_den %>% 
#                      dplyr::group_by(ProgramID, ProgramName, ProgramLocationID, QuadIdentifier, 
#                                      ReefIdentifier, GISUniqueID, SampleDate, Year, Month, ManagedAreaName,
#                                      Region.x, SurveyMethod, HabitatClassification, QuadSize_m2, MADup, reefIDcrosswalk, 
#                                      Region.y, MA_plotlab, Subtidal) %>%
#                      tidyr::fill(Density_m2, Number_of_Oysters_Counted_Total_Count, 
#                                  Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count,
#                                  DensIndex, NTotIndex, NLiveIndex, NDeadIndex) %>%
#                      tidyr::fill(Density_m2, Number_of_Oysters_Counted_Total_Count, 
#                                  Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count, 
#                                  DensIndex, NTotIndex, NLiveIndex, NDeadIndex, .direction = 'up') %>%
#                      dplyr::distinct()
# 
# new972_den <- subset(new972_den, !is.na(new972_den$Density_m2) |
#                              !is.na(new972_den$Number_of_Oysters_Counted_Total_Count) | 
#                              !is.na(new972_den$Number_of_Oysters_Counted_Live_Count) | 
#                              !is.na(new972_den$Number_of_Oysters_Counted_Dead_Count) |
#                              !is.na(new972_den$DensIndex) | !is.na(new972_den$NTotIndex) |
#                              !is.na(new972_den$NLiveIndex) | !is.na(new972_den$NDeadIndex))
# write.csv(new972_den, here::here("new972_den.csv"))

#Merge the new 972 data with the data for analysis.
new972_den_edited <- fread(here::here("new972_den_edited.csv"))
new972_den_edited[, V1 := NULL]
c(max(oysterraw_den$DensIndex, na.rm = TRUE), max(oysterraw_den$NTotIndex, na.rm = TRUE), max(oysterraw_den$NLiveIndex, na.rm = TRUE), max(oysterraw_den$NDeadIndex, na.rm = TRUE))
new972_den_edited[, `:=` (DensIndex = seq(max(oysterraw_den$DensIndex, na.rm = TRUE) + 1, max(oysterraw_den$DensIndex, na.rm = TRUE) + length(new972_den_edited$ProgramID)), NTotIndex = seq(max(oysterraw_den$NTotIndex, na.rm = TRUE) + 1, max(oysterraw_den$NTotIndex, na.rm = TRUE) + length(new972_den_edited$ProgramID)), NLiveIndex = seq(max(oysterraw_den$NLiveIndex, na.rm = TRUE) + 1, max(oysterraw_den$NLiveIndex, na.rm = TRUE) + length(new972_den_edited$ProgramID)), NDeadIndex = seq(max(oysterraw_den$NDeadIndex, na.rm = TRUE) + 1, max(oysterraw_den$NDeadIndex, na.rm = TRUE) + length(new972_den_edited$ProgramID)), Subtidal = FALSE)]
new972_den_edited[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
new972_den_edited[, Density_m2 := Number_of_Oysters_Counted_Live_Count/QuadSize_m2]
new972_den_edited[, QuadIdentifier := paste0(ProgramLocationID, "_", Month, Year, "_", QuadIdentifier)]
new972_den_edited[, Year := as.character(Year)]
new972_den_edited[, Month := as.character(Month)]
new972_den_edited[, reefIDcrosswalk := as.character(ReefIdentifier)]

setdiff(colnames(oysterraw_den), colnames(new972_den_edited))

oysterraw_den_no972 <- subset(oysterraw_den, oysterraw_den$ProgramID != 972)
oysterraw_den <- rbind(oysterraw_den_no972, new972_den_edited)


#Create data table of percent live
#oysterraw_pct <- oysterraw[, c(2:6, 11:17, 18:19, 22:23, 26, 28:30, 32:35)]
oysterraw_pct <- oysterraw[, c("ProgramID", "ProgramName", "ProgramLocationID", "QuadIdentifier", "ReefIdentifier", "GISUniqueID", "SampleDate", "Year", "Month", "ManagedAreaName", "Region.x", "SurveyMethod", "PercentLiveMethod", "HabitatClassification", "QuadSize_m2", "MADup", "PercentLive_pct", "Number_of_Oysters_Counted_Total_Count", "Number_of_Oysters_Counted_Live_Count", "Number_of_Oysters_Counted_Dead_Count", "PctIndex", "NTotIndex", "NLiveIndex", "NDeadIndex", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal")]
oysterraw_pct <- unique(oysterraw_pct)
oysterraw_pct <- oysterraw_pct %>% 
                     dplyr::group_by(ProgramID, ProgramName, ProgramLocationID, QuadIdentifier, 
                                     ReefIdentifier, GISUniqueID, SampleDate, Year, Month, ManagedAreaName,
                                     Region.x, SurveyMethod, PercentLiveMethod, HabitatClassification, QuadSize_m2, MADup, 
                                     reefIDcrosswalk, Region.y, MA_plotlab, Subtidal) %>%
                     tidyr::fill(PercentLive_pct, Number_of_Oysters_Counted_Total_Count, 
                                 Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count, 
                                 PctIndex, NTotIndex, NLiveIndex, NDeadIndex) %>%
                     tidyr::fill(PercentLive_pct, Number_of_Oysters_Counted_Total_Count, 
                                 Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count, 
                                 PctIndex, NTotIndex, NLiveIndex, NDeadIndex, .direction = 'up') %>%
                     dplyr::distinct()



oysterraw_pct <- subset(oysterraw_pct, !is.na(oysterraw_pct$PercentLive_pct) |
                             !is.na(oysterraw_pct$Number_of_Oysters_Counted_Total_Count) | 
                             !is.na(oysterraw_pct$Number_of_Oysters_Counted_Live_Count) | 
                             !is.na(oysterraw_pct$Number_of_Oysters_Counted_Dead_Count) |
                             !is.na(oysterraw_pct$PctIndex) | !is.na(oysterraw_pct$NTotIndex) |
                             !is.na(oysterraw_pct$NLiveIndex) | !is.na(oysterraw_pct$NDeadIndex))


#Add new RowIDs
#oysterraw_sh$RowID <- c(1:length(oysterraw_sh$ProgramID))
#oysterraw_den$RowID <- c(1:length(oysterraw_den$ProgramID))


#4/12/2021 - Adding in updated raw data for ID972 from "All_Parameters_but_Hectares-2021-Mar-12.csv" because it has MADup duplication issues that prevent me from running the script with it from the beginning.
new972_pct_edited <- copy(new972_den_edited)
new972_pct_edited[, PercentLive_pct := (Number_of_Oysters_Counted_Live_Count/Number_of_Oysters_Counted_Total_Count)*100]
setnames(new972_pct_edited, "DensIndex", "PctIndex")
new972_pct_edited[, Density_m2 := NULL]
new972_pct_edited[, PercentLiveMethod := "Percent"]
new972_pct_edited[, `:=` (PctIndex = seq(max(oysterraw_pct$PctIndex, na.rm = TRUE) + 1, max(oysterraw_pct$PctIndex, na.rm = TRUE) + length(new972_pct_edited$ProgramID)), NTotIndex = seq(max(oysterraw_pct$NTotIndex, na.rm = TRUE) + 1, max(oysterraw_pct$NTotIndex, na.rm = TRUE) + length(new972_pct_edited$ProgramID)), NLiveIndex = seq(max(oysterraw_pct$NLiveIndex, na.rm = TRUE) + 1, max(oysterraw_pct$NLiveIndex, na.rm = TRUE) + length(new972_pct_edited$ProgramID)), NDeadIndex = seq(max(oysterraw_pct$NDeadIndex, na.rm = TRUE) + 1, max(oysterraw_pct$NDeadIndex, na.rm = TRUE) + length(new972_pct_edited$ProgramID)), Subtidal = FALSE)]

setdiff(colnames(oysterraw_pct), colnames(new972_pct_edited))

oysterraw_pct_no972 <- subset(oysterraw_pct, oysterraw_pct$ProgramID != 972)
oysterraw_pct <- rbind(oysterraw_pct_no972, new972_pct_edited)

```

***

## Sample locations by indicator

<br>

Oyster reef sample locations map clipped to those locations where shell height data were collected. Grey sample locations are those that did not match to one of the oyster reef polygons. Note that the sample locations are jittered so that indicators measured at the same location will still be visible.

<br>

```{r SampleLocationsByIndicator-AllDates-Map, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}

othernerrs <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/othernerrs.rds'))
GTMnew <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/GTMnew.rds'))
aps <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/aps.rds'))
oysamplelocs_m <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/oysamplelocs_m.rds'))
fwcoymap_m_rcp <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/fwcoymap_m_rcp.rds'))
reefcrosswalk_rcp <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/reefcrosswalk_rcp.rds'))
GTMRegions <- readRDS(here::here('OysterGIS_files/reefIDcrosswalk_map_files/GTMRegions.rds'))
#HOBSsamplelocs <- subset(oysamplelocs_m, oysamplelocs_m$ProgramID == 5035)
ORCPallsites <- st_read(here::here("OysterGIS_files/orcp_all_sites/ORCP_Managed_Areas.shp"))
ORCPallsites <- st_transform(ORCPallsites, crs = 32119)

oysterraw_sh <- readRDS(here::here("oysterraw_sh.rds"))
reefcrosswalk_rcp_sh <- subset(reefcrosswalk_rcp, reefcrosswalk_rcp$ProgramLoc %in% unique(oysterraw_sh$ProgramLocationID))
reefcrosswalk_rcp_sh$ProgramID <- as.factor(reefcrosswalk_rcp_sh$ProgramID)
reefcrosswalk_rcp_sh <- st_jitter(reefcrosswalk_rcp_sh, factor = 0.00001)

oysterraw_den_nona <- readRDS(here::here("oysterraw_den_nona.rds"))
reefcrosswalk_rcp_den <- subset(reefcrosswalk_rcp, reefcrosswalk_rcp$ProgramLoc %in% unique(oysterraw_den_nona$ProgramLocationID))
reefcrosswalk_rcp_den$ProgramID <- as.factor(reefcrosswalk_rcp_den$ProgramID)
reefcrosswalk_rcp_den <- st_jitter(reefcrosswalk_rcp_den, factor = 0.00001)

oysterraw_pct_nona <- readRDS(here::here("oysterraw_pct_nona.rds"))
reefcrosswalk_rcp_pct <- subset(reefcrosswalk_rcp, reefcrosswalk_rcp$ProgramLoc %in% unique(oysterraw_pct_nona$ProgramLocationID))
reefcrosswalk_rcp_pct$ProgramID <- as.factor(reefcrosswalk_rcp_pct$ProgramID)
reefcrosswalk_rcp_pct <- st_jitter(reefcrosswalk_rcp_pct, factor = 0.00001)

mapviewOptions(fgb = FALSE) #fgb mime type not yet supported by pandoc, was causing errors (https://stackoverflow.com/questions/66107760/why-have-i-lost-ability-to-use-mapshot)
mapview(ORCPallsites, color = "blue", col.regions = "blue", alpha.regions = 0, layer.name = "RCP Managed Areas") +
  #mapview(GTMnew, color = "dark grey", col.regions = "dark grey", alpha.regions = 0, layer.name = "Guana Tolomato Matanzas NERR") +
  #mapview(aps, color = "blue", col.regions = "blue", alpha.regions = 0, layer.name = "Florida Aquatic Preserves") +
  mapview(GTMRegions, alpha.regions = 0.15, layer.name = "GTM NERR Regions") +
  mapview(fwcoymap_m_rcp, col.regions = "sienna", layer.name = "Oyster reefs") +
  mapview(subset(reefcrosswalk_rcp_sh, reefcrosswalk_rcp_sh$ProgramID != 5035), col.regions = "green3", layer.name = "Live oyster size class samples") +
  mapview(subset(reefcrosswalk_rcp_sh, reefcrosswalk_rcp_sh$ProgramID == 5035), col.regions = "firebrick", layer.name = "HOBS samples")
  #mapview(reefcrosswalk_rcp_den, col.regions = "deepskyblue3", layer.name = "Oyster density samples") +
  #mapview(reefcrosswalk_rcp_pct, col.regions = "orangered", layer.name = "Oyster percent live samples")

```

<br><br><br>

***

## Oyster size class

```{r Process-and-summarize-shell-height-data, echo=TRUE, message=FALSE, warning=FALSE}

oysterraw_sh <- oysterraw_sh %>% mutate(SampleDate = mdy_hms(SampleDate)) #convert Time to a timestamp
setDT(oysterraw_sh)
oysterraw_sh <- oysterraw_sh[LiveDate == "LiveDate unknown for dead shells", LiveDate := year(SampleDate)]
oysterraw_sh[, LiveDate2 := ifelse(LiveDate %in% "", year(SampleDate), ifelse(grepl("/", LiveDate, fixed = 
             TRUE), year(mdy(LiveDate)), ifelse(grepl("-", LiveDate, fixed = TRUE), year(ymd(LiveDate)), 
             LiveDate)))] 
oysterraw_sh[, LiveDate2 := as.numeric(LiveDate2)][, ('LiveDate2') := round(.SD, 0), .SDcols = 'LiveDate2']
oysterraw_sh <- oysterraw_sh[!is.na(LiveDate2)]
oysterraw_sh[, LiveDate2 := strptime(LiveDate2, "%Y")]
#oysterraw_sh[, MinimumSizeMeasured_mm := as.integer(MinimumSizeMeasured_mm)][ProgramID == 5035, MinimumSizeMeasured_mm := 20][ProgramID == 4016, NumberMeasured_n := 50]
oysterraw_sh[, LiveDate2 := year(ymd(LiveDate2))]

#Remove unrealistically high shell heights from ID_5017
Fix5017 <- oysterraw_sh[ProgramID == 5017, ][ShellHeight_mm < 165, ]
no5017 <- oysterraw_sh[ProgramID != 5017, ]
oysterraw_sh <- rbind(Fix5017, no5017)

#Make all LiveDate_Qualifier values that say "Exact (for live specimens only)" just say "Exact"
oysterraw_sh <- oysterraw_sh[LiveDate_Qualifier == "Exact (for live specimens only)", LiveDate_Qualifier := "Exact"]

#Save a copy of oysterraw_sh to make it faster to run portions of the scripts in the future
#saveRDS(oysterraw_sh, here::here('oysterraw_sh.rds'))

#summarize shell height data
sh_all_sum <- summarySE(oysterraw_sh, measurevar = 'ShellHeight_mm', groupvars = c('ManagedAreaName', 
                        'LiveDate_Qualifier', 'LiveDate2'))
```

### Shell height data

[Click here to view the oyster shell height data file.](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7B486F123A-EED7-486F-8000-FC3B92D4C520%7D&file=OysterShellHeight_AllDates.xlsx&action=default&mobileredirect=true)

```{r Shell-height-data, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_sh, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:25), fontSize = '80%')

write.xlsx(oysterraw_sh, file = here::here("DocsForSMEs/OysterShellHeight_AllDates.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br><br>

### Plot of shell height data availability

```{r Dot-plot-of-shell-height-data-availability-by-year-all-data, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
SH_AllDates_DataAvailability <- ggplot(sh_all_sum, aes(x = LiveDate2, y = ManagedAreaName, fill = LiveDate_Qualifier)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), shape = 21, color = "black", alpha = 0.5) +
  xlim(1950, 2020)
SH_AllDates_DataAvailability

ggsave(here::here(paste0("OA_plots/SH_AllDates_DataAvailability_", Sys.Date(), ".jpeg")),
       SH_AllDates_DataAvailability,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)

```

<br><br><br>

```{r echo=TRUE}
#Subset to shell heights >25mm
sh_o25 <- oysterraw_sh[ShellHeight_mm >= 25, ]

#Subset to only shell heights >75mm
sh_o75 <- oysterraw_sh[ShellHeight_mm >= 75, ]


#Add in the mean and sd of specimen-level calibrated radiocarbon results
radiodat <- fread(here::here("ID5035_RadiocarbonCalibrationSampleSummary_2021-01-12.csv"))

# #------------------------------------------------------------------------------------------------------
# #Approach to try for including time-averaging because "me" function is taking way too long: assign ages to individual SH measurements based on average probabilities for each year in the 14C posterior probability distributions for all specimens dated in each sample. Below is code I started to examine this approach for BH_R3H2S1, but I do not have the time to finish investigating this approach and to implement it now. The probabilities from the average 14C posterior probability distribution can be used as weights in the "sample" function (the "prob" argument) so the ages assigned to the individual specimens will reflect the 14C probabilities for each sample. Despite the limited data, I think this might be a better approach than taking the median +/- a time averaging estimate (e.g., SD or Sample_corrected_posterior_age_estimate) and assuming each specimen has an equal probability of being of any age within the estimated range of time averaging.
# 
# radiodat[, Sample_corrected_posterior_age_estimate := round(.SD, 0), .SDcols = "Sample_corrected_posterior_age_estimate"]
# radiodat[Sample_corrected_posterior_age_estimate < 0, Sample_corrected_posterior_age_estimate := 0]
# radiodat[, minTA := round(Sample_median_age - Sample_corrected_posterior_age_estimate/2, 0)]
# radiodat[, maxTA := round(ifelse(Sample_median_age + Sample_corrected_posterior_age_estimate/2 < 2018, Sample_median_age + Sample_corrected_posterior_age_estimate/2, 2018), 0)]
# 
# pData2 <- readRDS("C:/Users/steph/Dropbox/Steve_CurrentProjects/HOBS/HOBS_project/TimeAveragingScript/project/pData2_02-10-2021.rds")
# 
# jointp_bh321 <- subset(pData2, pData2$sample == "BH_R3H2S1")
# jointp_bh321 <- pivot_wider(jointp_bh321, names_from = name, values_from = aProb, values_fill = 0)
# setDT(jointp_bh321)
# jointp_bh321[, mean_aProb := rowMeans(.SD), .SDcols = c("BH_R3H2S1-120", "BH_R3H2S1-149", "BH_R3H2S1-52", "BH_R3H2S1-66")]
# jointp_bh321_TArange <- subset(jointp_bh321, jointp_bh321$value >= 1988 & jointp_bh321$value <= 2018)
# saveRDS(jointp_bh321_TArange, "C:/Users/steph/Dropbox/SEACAR_oyster_analyses/GLMMs/jointp_bh321_TArange.rds")
# 
# ggplot(jointp_bh321, aes(x = value, y = mean_aProb)) +
#   geom_hline(yintercept = 0, color = 'grey', size = 0.5) +
#   geom_area(position = 'identity', alpha = 0.45, color = "black", size = 0.2) +
#   theme_bw() +
#   #scale_x_reverse() +
#   ylim(0, 1) +
#   labs(x = 'Age (yr)',
#        y = 'Annual probability') #+ 
# #  theme(panel.grid.major = element_line(linetype = "blank"), panel.grid.minor = element_line(linetype = "blank"))
# 
# weightstest <- readRDS(here::here("GLMMs/jointp_bh321_TArange.rds"))
# weights <- data.table(years = 1988:2018)
# setnames(weightstest, "value", "years")
# weights <- left_join(weights, weightstest)
# weights <- weights[, c(1,11)]
# setDT(weights)
# weights[is.na(mean_aProb), mean_aProb := 0]
# weights[, weights := mean_aProb + (1 - sum(mean_aProb))/(max(years)-min(years))]
# weights[, weights2 := mean_aProb + 0.000000001]
# #-----------------------------------------------------------------------------------------------------

radiodat_mn <- radiodat[, c("sample", "Sample_mean_age", "Sample_age_stdev")] #, "minTA", "maxTA")]
sh_o25[ProgramID == 5035, sample := paste0(substring(QuadIdentifier, 1, 2), substring(QuadIdentifier, nchar(QuadIdentifier) - 6, nchar(QuadIdentifier)))]
sh_o25 <- merge(sh_o25, radiodat_mn, by = "sample", all.x = TRUE)
sh_o25[, sample := NULL]
sh_o25[, Sample_mean_age := round(.SD, 0), .SDcols = 'Sample_mean_age']
sh_o25[ProgramID != 5035, Sample_mean_age := LiveDate2]
sh_o25[LiveDate_Qualifier != "Estimate", Sample_age_stdev := 0.0009]
sh_o25[LiveDate_Qualifier != "Estimate", Sample_mean_age_qualifier := "Exact"]
sh_o25[LiveDate_Qualifier == "Estimate", Sample_mean_age_qualifier := "Estimate"]
sh_o25[Sample_mean_age_qualifier != "Estimate", LiveDate_Qualifier := "Exact"]
#saveRDS(sh_o25, here::here("GLMMs/sh_o25.rds"))

sh_o75[ProgramID == 5035, sample := paste0(substring(QuadIdentifier, 1, 2), substring(QuadIdentifier, nchar(QuadIdentifier) - 6, nchar(QuadIdentifier)))]
sh_o75 <- merge(sh_o75, radiodat_mn, by = "sample", all.x = TRUE)
sh_o75[, sample := NULL]
sh_o75[, ('Sample_mean_age') := round(.SD, 0), .SDcols = 'Sample_mean_age']
sh_o75[ProgramID != 5035, Sample_mean_age := LiveDate2]
sh_o75[LiveDate_Qualifier != "Estimate", Sample_age_stdev := 0.0009]
sh_o75[LiveDate_Qualifier != "Estimate", Sample_mean_age_qualifier := "Exact"]
sh_o75[LiveDate_Qualifier == "Estimate", Sample_mean_age_qualifier := "Estimate"]
sh_o75[Sample_mean_age_qualifier != "Estimate", LiveDate_Qualifier := "Exact"]
#saveRDS(sh_o75, here::here("GLMMs/sh_o75.rds"))

```

### Shell height summary tables {.tabset}

#### Shell height >25mm

```{r Subset-shell-heights-o25-and-create-summary-table, echo=TRUE, message=FALSE, warning=FALSE}
#Subset to shell heights >25mm
#sh_o25 <- oysterraw_sh[ShellHeight_mm >= 25, ]

# sh_o25[, nReefs := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'LiveDate_Qualifier', 'NumberMeasured_n', 'LiveDate2')]
# sh_o25[NumberMeasured_n != c(""), nReefsbyMAandLD_allLDQ_No20 := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'LiveDate2')]
# sh_o25[, footnote := as.character(ProgramID)][ProgramID == 5035, footnote := "5035*"][ProgramID == 5072, footnote := "5072*"]
# sh_o25[NumberMeasured_n != c(""), nProgsbyMAandLD_allLDQ_No20 := length(unique(footnote)), by = c('ManagedAreaName', 'LiveDate2')]
# sh_o25[NumberMeasured_n != c(""), ProgsbyMAandLD_allLDQ_No20 := list(list(unique(footnote))), by = c('ManagedAreaName', 'LiveDate2')]
# sh_o25[NumberMeasured_n != c(""), nProgsbyMA_allLD_allLDQ_No20 := length(unique(footnote)), by = c('ManagedAreaName')]
# sh_o25[NumberMeasured_n != c(""), ProgsbyMA_allLD_allLDQ_No20 := list(list(unique(footnote))), by = c('ManagedAreaName')]

sh_o25[, nReefs := length(unique(reefIDcrosswalk)), by = c('MA_plotlab', 'LiveDate_Qualifier', 'NumberMeasured_n', 'Sample_mean_age')]
sh_o25[NumberMeasured_n != c(""), nReefsbyMAandLD_allLDQ_No20 := length(unique(reefIDcrosswalk)), by = c('MA_plotlab', 'Sample_mean_age')]
sh_o25[, footnote := as.character(ProgramID)][ProgramID == 5035, footnote := "5035*"][ProgramID == 5072, footnote := "5072*"]
sh_o25[NumberMeasured_n != c(""), nProgsbyMAandLD_allLDQ_No20 := length(unique(footnote)), by = c('MA_plotlab', 'Sample_mean_age')]
sh_o25[NumberMeasured_n != c(""), ProgsbyMAandLD_allLDQ_No20 := list(list(unique(footnote))), by = c('MA_plotlab', 'Sample_mean_age')]
sh_o25[NumberMeasured_n != c(""), nProgsbyMA_allLD_allLDQ_No20 := length(unique(footnote)), by = c('MA_plotlab')]
sh_o25[NumberMeasured_n != c(""), ProgsbyMA_allLD_allLDQ_No20 := list(list(unique(footnote))), by = c('MA_plotlab')]

#Create summary table showing number of reefs/programs of data included in sh_o25
sh_o25_sum1 <- unique(sh_o25[, .(MA_plotlab, Sample_mean_age, nReefsbyMAandLD_allLDQ_No20, nProgsbyMAandLD_allLDQ_No20, nProgsbyMA_allLD_allLDQ_No20)], by = c('MA_plotlab', 'Sample_mean_age', 'nReefsbyMAandLD_allLDQ_No20', 'nProgsbyMAandLD_allLDQ_No20', 'nProgsbyMA_allLD_allLDQ_No20'))
#sh_o25_sum1[, Sample_mean_age := Sample_mean_age][, Sample_mean_age := NULL]
listcols <- sh_o25[, .SD[1], by = c('MA_plotlab', 'Sample_mean_age')][, .(ProgsbyMAandLD_allLDQ_No20, ProgsbyMA_allLD_allLDQ_No20)]
sh_o25_sum1 <- cbind(sh_o25_sum1, listcols)
setcolorder(sh_o25_sum1, c('MA_plotlab', 'nProgsbyMA_allLD_allLDQ_No20', 'ProgsbyMA_allLD_allLDQ_No20', 'Sample_mean_age', 'nReefsbyMAandLD_allLDQ_No20', 'nProgsbyMAandLD_allLDQ_No20', 'ProgsbyMAandLD_allLDQ_No20'))
setorder(sh_o25_sum1, MA_plotlab, Sample_mean_age)

archeoyrs <- c(167, 382, 644, 892)
sh_o25_sum1[, nReefsbyMAandLD_allLDQ_No20 := as.character(nReefsbyMAandLD_allLDQ_No20)]
sh_o25_sum1[Sample_mean_age %in% archeoyrs, nReefsbyMAandLD_allLDQ_No20 := "Unknown**"]

#Create easily readable table in knitted document
#Better column names
sh_o25_sum1_renamed <- setnames(sh_o25_sum1, c('nProgsbyMA_allLD_allLDQ_No20', 'ProgsbyMA_allLD_allLDQ_No20', 'nReefsbyMAandLD_allLDQ_No20', 'nProgsbyMAandLD_allLDQ_No20', 'ProgsbyMAandLD_allLDQ_No20'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Get rid of temporary footnote column
sh_o25[, footnote := NULL]

#Group names
groups_o25 <- c()
for(i in unique(sh_o25_sum1$MA_plotlab)){
  name <- paste0(i, ", Total Programs = ", sh_o25_sum1[MA_plotlab == i, 2][1], ": ", sh_o25_sum1[MA_plotlab == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
sh_o25_sum1_renamed[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay_Natural, Total Programs = 4: c(5035*, 5063, 5071, 5073)" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Apalachicola Bay_Natural")$Sample_mean_age),
                      "Apalachicola Bay_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Apalachicola Bay_Restored")$Sample_mean_age),
                      "Apalachicola NERR_Natural, Total Programs = 5: c(5035*, 5063, 5071, 5073, 5075)" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Apalachicola NERR_Natural")$Sample_mean_age),
                      "Apalachicola NERR_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Apalachicola NERR_Restored")$Sample_mean_age),
                      "Big Bend Seagrasses_Natural, Total Programs = 1: 5035*" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Big Bend Seagrasses_Natural")$Sample_mean_age), 
                      "Boca Ciega Bay_Natural, Total Programs = 1: 4020" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Boca Ciega Bay_Natural")$Sample_mean_age), 
                      "Estero Bay_Natural, Total Programs = 2: c(4042, 5035*)" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Estero Bay_Natural")$Sample_mean_age), 
                      "Estero Bay_Restored, Total Programs = 1: 4012" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Estero Bay_Restored")$Sample_mean_age),
                      "Guana River Marsh_Natural, Total Programs = 3: c(4000, 5017, 5035*)" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Guana River Marsh_Natural")$Sample_mean_age),  
                      "Guana Tolomato Matanzas NERR_Natural, Total Programs = 3: c(4000, 5017, 5035*)" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Guana Tolomato Matanzas NERR_Natural")$Sample_mean_age), 
                      "Indian River-Malabar to Vero Beach_Natural, Total Programs = 1: 4016" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Indian River-Malabar to Vero Beach_Natural")$Sample_mean_age), 
                      "Indian River-Vero Beach to Ft. Pierce_Natural, Total Programs = 2: c(4016, 5035*)" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Indian River-Vero Beach to Ft. Pierce_Natural")$Sample_mean_age), 
                      "Jensen Beach to Jupiter Inlet_Natural, Total Programs = 1: 4016" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Jensen Beach to Jupiter Inlet_Natural")$Sample_mean_age), 
                      "Lemon Bay_Natural, Total Programs = 1: 5035*" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Lemon Bay_Natural")$Sample_mean_age), 
                      "Loxahatchee River-Lake Worth Creek_Natural, Total Programs = 1: 4014" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Loxahatchee River-Lake Worth Creek_Natural")$Sample_mean_age),
                      "Mosquito Lagoon_Natural, Total Programs = 1: 5017" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Mosquito Lagoon_Natural")$Sample_mean_age),  
                      "Nassau River-St. Johns River Marshes_Natural, Total Programs = 1: 5017" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Nassau River-St. Johns River Marshes_Natural")$Sample_mean_age), 
                      #"Nature Coast_Natural, Total Programs = 1: 5070" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Nature Coast_Natural")$Sample_mean_age),
                      "Pine Island Sound_Natural, Total Programs = 1: 4012" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Pine Island Sound_Natural")$Sample_mean_age),
                      "Pine Island Sound_Restored, Total Programs = 1: 4012" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Pine Island Sound_Restored")$Sample_mean_age),
                      "Pinellas County_Natural, Total Programs = 1: 4020" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Pinellas County_Natural")$Sample_mean_age),  
                      "St. Martins Marsh_Natural, Total Programs = 3: c(5070, 5072*, 5074)" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "St. Martins Marsh_Natural")$Sample_mean_age),
                      "Yellow River Marsh_Natural, Total Programs = 1: 5073" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Yellow River Marsh_Natural")$Sample_mean_age),
                      "Yellow River Marsh_Restored, Total Programs = 1: 4044" = length(subset(sh_o25_sum1, sh_o25_sum1$MA_plotlab == "Yellow River Marsh_Restored")$Sample_mean_age)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  add_footnote(c("*Program data are measurements of dead oyster shells of estimated age, not real-time monitoring.", "**The specimens measured for this program were from archaeological middens, so the reefs they came from are unknown."), notation = "none") %>%
  scroll_box(height = "500px")
```

<br><br><br>

#### Shell height >75mm

```{r Shell height >75mm summary table, echo=TRUE, message = FALSE, warning = FALSE}
#Subset to only shell heights >75mm
#sh_o75 <- oysterraw_sh[ShellHeight_mm >= 75, ]

sh_o75[, nReefs := length(unique(reefIDcrosswalk)), by = c('MA_plotlab', 'LiveDate_Qualifier', 'NumberMeasured_n', 'Sample_mean_age')]
#sh_o75[, nReefs := length(unique(reefIDcrosswalk)), by = c('MA_plotlab', 'NumberMeasured_n', 'Sample_mean_age')]
sh_o75[NumberMeasured_n != "", nReefsbyMAandLD_allLDQ_No75 := length(unique(reefIDcrosswalk)), by = c('MA_plotlab', 'Sample_mean_age')]
sh_o75[, footnote := as.character(ProgramID)][ProgramID == 5035, footnote := "5035*"][ProgramID == 5072, footnote := "5072*"]
sh_o75[NumberMeasured_n != "", nProgsbyMAandLD_allLDQ_No75 := length(unique(footnote)), by = c('MA_plotlab', 'Sample_mean_age')]
sh_o75[NumberMeasured_n != "", ProgsbyMAandLD_allLDQ_No75 := list(list(unique(footnote))), by = c('MA_plotlab', 'Sample_mean_age')]
sh_o75[NumberMeasured_n != "", nProgsbyMA_allLD_allLDQ_No75 := length(unique(footnote)), by = c('MA_plotlab')]
sh_o75[NumberMeasured_n != "", ProgsbyMA_allLD_allLDQ_No75 := list(list(unique(footnote))), by = c('MA_plotlab')]

#Create summary table showing number of reefs/programs of data included in sh_o75
sh_o75_sum1 <- unique(sh_o75[, .(MA_plotlab, Sample_mean_age, nReefsbyMAandLD_allLDQ_No75, nProgsbyMAandLD_allLDQ_No75, nProgsbyMA_allLD_allLDQ_No75)], by = c('MA_plotlab', 'Sample_mean_age', 'nReefsbyMAandLD_allLDQ_No75', 'nProgsbyMAandLD_allLDQ_No75', 'nProgsbyMA_allLD_allLDQ_No75'))
#sh_o75_sum1[, Sample_mean_age := Sample_mean_age][, Sample_mean_age := NULL]
listcols <- sh_o75[, .SD[1], by = c('MA_plotlab', 'Sample_mean_age')][, .(ProgsbyMAandLD_allLDQ_No75, ProgsbyMA_allLD_allLDQ_No75)]
sh_o75_sum1 <- cbind(sh_o75_sum1, listcols)
setcolorder(sh_o75_sum1, c('MA_plotlab', 'Sample_mean_age', 'nReefsbyMAandLD_allLDQ_No75', 'nProgsbyMAandLD_allLDQ_No75', 'ProgsbyMAandLD_allLDQ_No75', 'nProgsbyMA_allLD_allLDQ_No75', 'ProgsbyMA_allLD_allLDQ_No75'))
setorder(sh_o75_sum1, MA_plotlab, Sample_mean_age)

archeoyrs <- c(167, 382, 644, 892)
sh_o75_sum1[, nReefsbyMAandLD_allLDQ_No75 := as.character(nReefsbyMAandLD_allLDQ_No75)]
sh_o75_sum1[Sample_mean_age %in% archeoyrs, nReefsbyMAandLD_allLDQ_No75 := "Unknown**"]

#Create easily readable table in knitted document
#Better column names
sh_o75_sum1_renamed <- setnames(sh_o75_sum1, c('nProgsbyMA_allLD_allLDQ_No75', 'ProgsbyMA_allLD_allLDQ_No75', 'nReefsbyMAandLD_allLDQ_No75', 'nProgsbyMAandLD_allLDQ_No75', 'ProgsbyMAandLD_allLDQ_No75'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Get rid of temporary footnote column
sh_o75[, footnote := NULL]

#Group names
groups <- c()
for(i in unique(sh_o75_sum1$MA_plotlab)){
  name <- paste0(i, ", Total Programs = ", sh_o75_sum1[MA_plotlab == i, 2][1], ": ", sh_o75_sum1[MA_plotlab == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
sh_o75_sum1_renamed[, 2:5] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay_Natural, Total Programs = 4: c(5035*, 5063, 5071, 5073)" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Apalachicola Bay_Natural")$Sample_mean_age),
                      "Apalachicola Bay_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Apalachicola Bay_Restored")$Sample_mean_age),
                      "Apalachicola NERR_Natural, Total Programs = 5: c(5035*, 5063, 5071, 5073, 5075)" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Apalachicola NERR_Natural")$Sample_mean_age),
                      "Apalachicola NERR_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Apalachicola NERR_Restored")$Sample_mean_age),
                      "Big Bend Seagrasses_Natural, Total Programs = 1: 5035*" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Big Bend Seagrasses_Natural")$Sample_mean_age), 
                      "Boca Ciega Bay_Natural, Total Programs = 1: 4020" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Boca Ciega Bay_Natural")$Sample_mean_age), 
                      "Estero Bay_Natural, Total Programs = 2: c(4042, 5035*)" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Estero Bay_Natural")$Sample_mean_age), 
                      "Estero Bay_Restored, Total Programs = 1: 4012" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Estero Bay_Restored")$Sample_mean_age),
                      "Guana River Marsh_Natural, Total Programs = 3: c(4000, 5017, 5035*)" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Guana River Marsh_Natural")$Sample_mean_age),  
                      "Guana Tolomato Matanzas NERR_Natural, Total Programs = 3: c(4000, 5017, 5035*)" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Guana Tolomato Matanzas NERR_Natural")$Sample_mean_age), 
                      "Indian River-Malabar to Vero Beach_Natural, Total Programs = 1: 4016" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Indian River-Malabar to Vero Beach_Natural")$Sample_mean_age), 
                      "Indian River-Vero Beach to Ft. Pierce_Natural, Total Programs = 2: c(4016, 5035*)" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Indian River-Vero Beach to Ft. Pierce_Natural")$Sample_mean_age), 
                      #"Jensen Beach to Jupiter Inlet_Natural, Total Programs = 1: 4016" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Jensen Beach to Jupiter Inlet_Natural")$Sample_mean_age), 
                      "Lemon Bay_Natural, Total Programs = 1: 5035*" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Lemon Bay_Natural")$Sample_mean_age), 
                      "Loxahatchee River-Lake Worth Creek_Natural, Total Programs = 1: 4014" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Loxahatchee River-Lake Worth Creek_Natural")$Sample_mean_age),
                      "Mosquito Lagoon_Natural, Total Programs = 1: 5017" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Mosquito Lagoon_Natural")$Sample_mean_age),  
                      "Nassau River-St. Johns River Marshes_Natural, Total Programs = 1: 5017" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Nassau River-St. Johns River Marshes_Natural")$Sample_mean_age), 
                      #"Nature Coast_Natural, Total Programs = 1: 5070" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Nature Coast_Natural")$Sample_mean_age),
                      "Pine Island Sound_Natural, Total Programs = 1: 4012" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Pine Island Sound_Natural")$Sample_mean_age),
                      "Pine Island Sound_Restored, Total Programs = 1: 4012" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Pine Island Sound_Restored")$Sample_mean_age),
                      "Pinellas County_Natural, Total Programs = 1: 4020" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Pinellas County_Natural")$Sample_mean_age),  
                      "St. Martins Marsh_Natural, Total Programs = 3: c(5070, 5072*, 5074)" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "St. Martins Marsh_Natural")$Sample_mean_age),
                      "Yellow River Marsh_Natural, Total Programs = 1: 5073" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Yellow River Marsh_Natural")$Sample_mean_age)),
                      #"Yellow River Marsh_Restored, Total Programs = 1: 4044" = length(subset(sh_o75_sum1, sh_o75_sum1$MA_plotlab == "Yellow River Marsh_Restored")$Sample_mean_age)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  add_footnote(c("*Program data are measurements of dead oyster shells of estimated age, not real-time monitoring.", "**The specimens measured for this program were from archaeological middens, so the reefs they came from are unknown."), notation = "none") %>%
  scroll_box(height = "500px")

```


<br><br><br> 

### Histograms by reef and year {.tabset .tabset-fade}

#### Shell height >25mm {.tabset .tabset-fade .tabset-pills}

<br>

All histograms have 5mm bins.

<br>

##### Apalachicola Bay

```{r Histograms-ApalachicolaBay-o25, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_AB_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Apalachicola Bay"), aes(x = ShellHeight_mm)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y') +
  theme_bw() + theme(axis.text.x = element_text(angle = 90))
SH_AllDates_Hist_AB_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_AB_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_AB_o25,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)

```

<br><br><br>  

##### Apalachicola NERR

```{r Histograms-ApalachicolaNERR-o25, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_ANERR_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Apalachicola NERR"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_ANERR_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_ANERR_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_ANERR_o25,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Big Bend Seagrasses

```{r Histograms-BigBendSeagrasses-o25, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_BBS_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Big Bend Seagrasses"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_BBS_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_BBS_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_BBS_o25,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Boca Ciega Bay

```{r Histograms-BocaCiegaBay-o25, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_BCB_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Boca Ciega Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_BCB_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_BCB_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_BCB_o25,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Estero Bay

```{r Histograms-EsteroBay-o25, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_EB_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Estero Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_EB_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_EB_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_EB_o25,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Guana River Marsh

```{r Histograms-GuanaRiverMarsh-o25, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_GRM_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Guana River Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_GRM_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_GRM_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_GRM_o25,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Guana Tolomato Matanzas NERR

```{r Histograms-GuanaTolomatoMatanzasNERR-o25, echo=TRUE, fig.height=100, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_GTMNERR_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Guana Tolomato Matanzas NERR"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_GTMNERR_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_GTMNERR_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_GTMNERR_o25,
       width = 10,
       height = 100,
       units = "in",
       dpi = 300,
       limitsize = FALSE)
```

<br><br><br>  

##### Indian River-Malabar to Vero Beach

```{r Histograms-IndianRiverMalabartoVeroBeach-o25, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_IRMVB_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Indian River-Malabar to Vero Beach"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_IRMVB_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_IRMVB_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_IRMVB_o25,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Indian River-Vero Beach to Ft. Pierce

```{r Histograms-IndianRiverVeroBeachtoFtPierce-o25, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_IRVBFP_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Indian River-Vero Beach to Ft. Pierce"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_IRVBFP_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_IRVBFP_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_IRVBFP_o25,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Jensen Beach to Jupiter Inlet

```{r Histograms-JensenBeachtoJupiterInlet-o25, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_JBJI_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Jensen Beach to Jupiter Inlet"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_JBJI_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_JBJI_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_JBJI_o25,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Lemon Bay

```{r Histograms-LemonBay-o25, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_LB_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Lemon Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_LB_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_LB_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_LB_o25,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Loxahatchee River-Lake Worth Creek

```{r Histograms-LoxahatcheeRiverLakeWorthCreek-o25, echo=TRUE, fig.height=80, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_LRLWC_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Loxahatchee River-Lake Worth Creek"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_LRLWC_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_LRLWC_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_LRLWC_o25,
       width = 10,
       height = 80,
       units = "in",
       dpi = 300,
       limitsize = FALSE)
```

<br><br><br>  

##### Mosquito Lagoon

```{r Histograms-MosquitoLagoon-o25, echo=TRUE, fig.height=30, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_ML_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Mosquito Lagoon"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_ML_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_ML_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_ML_o25,
       width = 10,
       height = 30,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Nassau River-St. Johns River Marshes

```{r Histograms-NassauRiverStJohnsRiverMarshes-o25, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_NRSJRM_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Nassau River-St. Johns River Marshes"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_NRSJRM_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_NRSJRM_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_NRSJRM_o25,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br>  

<!-- ##### Nature Coast -->

<!-- ```{r Histograms-NatureCoast-o25, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"} -->
<!-- SH_AllDates_Hist_NC_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Nature Coast"), aes(x = ShellHeight_mm)) + -->
<!--   theme_bw() + theme(axis.text.x = element_text(angle = 90)) + -->
<!--   geom_histogram(fill = 'grey', color = 'black', binwidth = 5) + -->
<!--   facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y') -->
<!-- SH_AllDates_Hist_NC_o25 -->

<!-- ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_NC_o25_", Sys.Date(), ".jpeg")), -->
<!--        SH_AllDates_Hist_NC_o25, -->
<!--        width = 10, -->
<!--        height = 10, -->
<!--        units = "in", -->
<!--        dpi = 300) -->
<!-- ``` -->

<!-- <br><br><br><br>   -->

##### Pine Island Sound

```{r Histograms-PineIslandSound-o25, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_PIS_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Pine Island Sound"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_PIS_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_PIS_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_PIS_o25,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Pinellas County

```{r Histograms-PinellasCounty-o25, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_PCo_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Pinellas County"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_PCo_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_PCo_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_PCo_o25,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### St. Martins Marsh

```{r Histograms-StMartinsMarsh-o25, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_SMM_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "St. Martins Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_SMM_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_SMM_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_SMM_o25,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Yellow River Marsh

```{r Histograms-YellowRiverMarsh-o25, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_YRM_o25 <- ggplot(subset(sh_o25, sh_o25$ManagedAreaName == "Yellow River Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_YRM_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_YRM_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_YRM_o25,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>  


#### Shell height >75mm {.tabset .tabset-fade .tabset-pills}

<br>

All histograms have 5mm bins.

<br>

##### Apalachicola NERR
```{r Histograms-ApalachicolaNERR-o75, echo=TRUE, fig.height=40, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_ANERR_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Apalachicola NERR"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_ANERR_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_ANERR_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_ANERR_o75,
       width = 10,
       height = 40,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Big Bend Seagrasses
```{r Histograms-BigBendSeagrasses-o75, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_BBS_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Big Bend Seagrasses"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_BBS_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_BBS_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_BBS_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Boca Ciega Bay
```{r Histograms-BocaCiegaBay-o75, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_BCB_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Boca Ciega Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_BCB_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_BCB_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_BCB_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Estero Bay
```{r Histograms-EsteroBay-o75, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_EB_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Estero Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_EB_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_EB_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_EB_o75,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Guana River Marsh
```{r Histograms-GuanaRiverMarsh-o75, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_GRM_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Guana River Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_GRM_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_GRM_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_GRM_o75,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Guana Tolomato Matanzas NERR
```{r Histograms-GuanaTolomatoMatanzasNERR-o75, echo=TRUE, fig.height=80, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_GTMNERR_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Guana Tolomato Matanzas NERR"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_GTMNERR_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_GTMNERR_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_GTMNERR_o75,
       width = 10,
       height = 80,
       units = "in",
       dpi = 300,
       limitsize = FALSE)
```

<br><br><br> 

##### Indian River-Malabar to Vero Beach
```{r Histograms-IndianRiverMalabartoVeroBeach-o75, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_IRMVB_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Indian River-Malabar to Vero Beach"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_IRMVB_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_IRMVB_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_IRMVB_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Indian River-Vero Beach to Ft. Pierce
```{r Histograms-IndianRiverVeroBeachtoFtPierce-o75, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_IRVBFP_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Indian River-Vero Beach to Ft. Pierce"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_IRVBFP_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_IRVBFP_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_IRVBFP_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Lemon Bay
```{r Histograms-LemonBay-o75, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_LB_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Lemon Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_LB_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_LB_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_LB_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Loxahatchee River-Lake Worth Creek
```{r Histograms-LoxahatcheeRiverLakeWorthCreek-o75, echo=TRUE, fig.height=80, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_LRLWC_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Loxahatchee River-Lake Worth Creek"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_LRLWC_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_LRLWC_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_LRLWC_o75,
       width = 10,
       height = 80,
       units = "in",
       dpi = 300,
       limitsize = FALSE)
```

<br><br><br> 

##### Mosquito Lagoon
```{r Histograms-MosquitoLagoon-o75, echo=TRUE, fig.height=30, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_ML_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Mosquito Lagoon"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_ML_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_ML_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_ML_o75,
       width = 10,
       height = 30,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Nassau River-St. Johns River Marshes
```{r Histograms-NassauRiverStJohnsRiverMarshes-o75, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_NRSJRM_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Nassau River-St. Johns River Marshes"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_NRSJRM_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_NRSJRM_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_NRSJRM_o75,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br> 

<!-- ##### Nature Coast -->
<!-- ```{r Histograms-NatureCoast-o75, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"} -->
<!-- SH_AllDates_Hist_NC_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Nature Coast"), aes(x = ShellHeight_mm)) + -->
<!--   theme_bw() + theme(axis.text.x = element_text(angle = 90)) + -->
<!--   geom_histogram(fill = 'grey', color = 'black', binwidth = 5) + -->
<!--   facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y') -->
<!-- SH_AllDates_Hist_NC_o75 -->

<!-- ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_NC_o75_", Sys.Date(), ".jpeg")), -->
<!--        SH_AllDates_Hist_NC_o75, -->
<!--        width = 10, -->
<!--        height = 5, -->
<!--        units = "in", -->
<!--        dpi = 300) -->
<!-- ``` -->

<!-- <br><br><br><br>   -->

##### Pine Island Sound
```{r Histograms-PineIslandSound-o75, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_PIS_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Pine Island Sound"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_PIS_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_PIS_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_PIS_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Pinellas County
```{r Histograms-PinellasCounty-o75, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_PCo_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Pinellas County"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_PCo_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_PCo_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_PCo_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### St. Martins Marsh
```{r Histograms-StMartinsMarsh-o75, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_SMM_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "St. Martins Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_SMM_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_SMM_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_SMM_o75,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Yellow River Marsh
```{r Histograms-YellowRiverMarsh-o75, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_AllDates_Hist_YRM_o75 <- ggplot(subset(sh_o75, sh_o75$ManagedAreaName == "Yellow River Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() + theme(axis.text.x = element_text(angle = 90)) +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_AllDates_Hist_YRM_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_Hist_YRM_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_Hist_YRM_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>


### Shell height plots by year {.tabset .tabset-fade}

#### Point plots {.tabset .tabset-fade .tabset-pills}

##### All shell heights

```{r AvgSHbyYRall-plot, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
#Average shell height by year and managed area
avg_sh_all <- oysterraw_sh[, MeanSH := mean(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, sdSH := sd(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, semSH := sd(ShellHeight_mm)/sqrt(length(ShellHeight_mm)), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')]

avg_sh_all[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
SH_AllDates_avg_all <- ggplot(avg_sh_all, aes(x = LiveDate2, y = MeanSH, color = as.factor(ProgramID))) +
  geom_point() +
  facet_wrap(~MA_plotlab, ncol = 3, scales = "free") +
#  xlim(1950, 2020) +
  theme_bw() + theme(axis.line = element_line()) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(1950, 2020)) +
  scale_y_continuous(limits = c(0, 70)) +
  #coord_cartesian(ylim = c(-15, 40)) +
  labs(color = "Program ID")
SH_AllDates_avg_all

ggsave(here::here(paste0("OA_plots/SH_AllDates_avg_all_", Sys.Date(), ".jpeg")),
       SH_AllDates_avg_all,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Shell height >25mm

```{r AvgSHbyYRo25-plot, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
#Average shell height by year and managed area (>25mm shell height only)
avg_sh_o25 <- sh_o25[, MeanSH := mean(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, sdSH := sd(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, semSH := sd(ShellHeight_mm)/sqrt(length(ShellHeight_mm)), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')]

avg_sh_o25[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
SH_AllDates_avg_o25 <- ggplot(avg_sh_o25, aes(x = LiveDate2, y = MeanSH, color = as.factor(ProgramID))) +
  theme_bw() +
  geom_point() +
  facet_wrap(~MA_plotlab, ncol = 3, scales = "free") +
  #xlim(1950, 2020)
  theme_bw() + theme(axis.line = element_line()) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(1950, 2020)) +
  scale_y_continuous(limits = c(25, 70)) +
  #coord_cartesian(ylim = c(-15, 40)) +
  labs(color = "Program ID")
SH_AllDates_avg_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_avg_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_avg_o25,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Shell height >75mm

```{r AvgSHbyYRo75-plot, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
#Average shell height by year and managed area (>75mm shell height only)
avg_sh_o75 <- sh_o75[, MeanSH := mean(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, sdSH := sd(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, semSH := sd(ShellHeight_mm)/sqrt(length(ShellHeight_mm)), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')]

avg_sh_o75[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
SH_AllDates_avg_o75 <- ggplot(avg_sh_o75, aes(x = LiveDate2, y = MeanSH, color = as.factor(ProgramID))) +
  theme_bw() +
  geom_point() +
  facet_wrap(~MA_plotlab, ncol = 3, scales = "free") +
  #xlim(1950, 2020)
  theme_bw() + theme(axis.line = element_line()) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(1950, 2020)) +
  scale_y_continuous(limits = c(75, 100)) +
  #coord_cartesian(ylim = c(-15, 40)) +
  labs(color = "Program ID")
SH_AllDates_avg_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_avg_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_avg_o75,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

#### Boxplots {.tabset .tabset-fade .tabset-pills}

##### Shell height >25mm

```{r SHbyYRo25-boxplots, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
sh_o25[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
SH_AllDates_byYR_o25 <- ggplot(sh_o25, aes(LiveDate2, ShellHeight_mm, group = LiveDate2)) + #color = as.factor(ProgramID))) +
  theme_bw() +
  geom_boxplot() +
  facet_wrap(~MA_plotlab, ncol = 3, scales = "free") +
#  annotate(geom = 'text', x = 1960, y = 100, label = unique(sh_o25$ProgramID), vjust = "inward", hjust = "inward") +
  #xlim(1950, 2020) #+
  theme_bw() + theme(axis.line = element_line()) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(1950, 2021)) +
  scale_y_continuous(limits = c(20, 200)) +
  #coord_cartesian(ylim = c(-15, 40)) +
  labs(color = "Program ID")
SH_AllDates_byYR_o25

ggsave(here::here(paste0("OA_plots/SH_AllDates_byYR_o25_", Sys.Date(), ".jpeg")),
       SH_AllDates_byYR_o25,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Shell height >75mm

```{r SHbyYRo75-boxplots, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
SH_AllDates_byYR_o75 <- ggplot(sh_o75, aes(LiveDate2, ShellHeight_mm, group = LiveDate2)) + #color = as.factor(ProgramID))) +
  theme_bw() +
  geom_boxplot() +
  facet_wrap(~MA_plotlab, ncol = 3, scales = "free") +
  #xlim(1950, 2020)
  theme_bw() + theme(axis.line = element_line()) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(1950, 2021)) +
  scale_y_continuous(limits = c(70, 175)) +
  #coord_cartesian(ylim = c(-15, 40)) +
  labs(color = "Program ID")
SH_AllDates_byYR_o75

ggsave(here::here(paste0("OA_plots/SH_AllDates_byYR_o75_", Sys.Date(), ".jpeg")),
       SH_AllDates_byYR_o75,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

***

## Live density

```{r DensitySetup, echo=TRUE, message=FALSE, warning=FALSE}
setDT(oysterraw_den)
# oysterraw_den <- oysterraw_den %>% mutate(SampleDate = mdy_hms(SampleDate))
# oysterraw_den[, Month := month(SampleDate)]
# oysterraw_den[, YrMo := paste0(Year, "-", Month)]

#More complicated conversion of date columns needed because ID_972 data do not have the hms format for time like the default in the combined table exports. When it eventually is corrected and fixed in the combined table export, then all program data should have the same SampleDate format and the above code should work again.
oysterraw_den_no972 <- setDT(subset(oysterraw_den, oysterraw_den$ProgramID != 972)) %>% mutate(SampleDate = mdy_hms(SampleDate))
oysterraw_den_no972[, Month := month(SampleDate)]
oysterraw_den_no972[, YrMo := paste0(Year, "-", Month)]

oysterraw_den_972 <- setDT(subset(oysterraw_den, oysterraw_den$ProgramID == 972)) %>% mutate(SampleDate = mdy_hm(SampleDate))
oysterraw_den_972[, Month := month(SampleDate)]
oysterraw_den_972[, YrMo := paste0(Year, "-", Month)]

oysterraw_den <- rbind(oysterraw_den_no972, oysterraw_den_972)

#Fix QuadID and ReefID columns for 2003 data in program 4014
Reefs_4014_2003 <- c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13')
Quads_4014_2003 <- c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '13', '14')
Fix4014 <- subset(oysterraw_den, oysterraw_den$ProgramID == 4014)
Fix4014[Year == 2003, QuadIdentifier := Quads_4014_2003]
Fix4014[Year == 2003, ReefIdentifier := Reefs_4014_2003]
Fix4014[Year == 2003, Density_m2 := Number_of_Oysters_Counted_Live_Count * 4]
no4014 <- subset(oysterraw_den, oysterraw_den$ProgramID != 4014)
oysterraw_den <- rbind(Fix4014, no4014)

#Fix density for program 972
#oysterraw_den <- oysterraw_den[ProgramID == 972, Density_m2 := (Number_of_Oysters_Counted_Live_Count/6) * 4]

#Fix density for program 4012
Fix4012 <- oysterraw_den[ProgramID == 4012, ][is.na(Density_m2), Density_m2 := Number_of_Oysters_Counted_Live_Count / as.numeric(QuadSize_m2)]
Fix4012 <- Fix4012[QuadIdentifier %like% "_Ref", HabitatClassification := "Natural"]
Fix4012 <- Fix4012[QuadIdentifier %like% "_C", HabitatClassification := "Natural"]
no4012 <- subset(oysterraw_den, oysterraw_den$ProgramID != 4012)
oysterraw_den <- rbind(Fix4012, no4012)

#Fix density for program 4042
Fix4042 <- oysterraw_den[ProgramID == 4042, ][is.na(Density_m2), Density_m2 := Number_of_Oysters_Counted_Live_Count / as.numeric(QuadSize_m2)]
no4042 <- subset(oysterraw_den, oysterraw_den$ProgramID != 4042)
oysterraw_den <- rbind(Fix4042, no4042)

#Fix density for program 4016
Fix4016 <- oysterraw_den[ProgramID == 4016, ][is.na(Density_m2), Density_m2 := Number_of_Oysters_Counted_Live_Count / as.numeric(QuadSize_m2)]
no4016 <- subset(oysterraw_den, oysterraw_den$ProgramID != 4016)
oysterraw_den <- rbind(Fix4016, no4016)

```

```{r echo=TRUE}
#Summarize density data by managed area
#oysterraw_den <- readRDS(here::here('oysterraw_den.rds'))
oysterraw_den_nona <- subset(oysterraw_den, !is.na(oysterraw_den$Density_m2))
oysterraw_den_nona[, Year := as.integer(Year)]
oysterraw_den_nona[ProgramID == 4000, QuadSize_m2 := 0.0625]
oysterraw_den_nona[ProgramID == 4000, Density_m2 := Number_of_Oysters_Counted_Total_Count/QuadSize_m2]
den_all_sum <- summarySE(oysterraw_den_nona, measurevar = 'Density_m2', groupvars = c('ManagedAreaName', 'Year'))

#Summarize density data by managed area (mean density 25mm <= x < 75)
oysterraw_den_r_seed <- readRDS(here::here('oysterraw_den_r_seed.rds'))
#Need to remove HOBS data and 5072 data from density because density of DA not comparable to live density.
oysterraw_den_r_seed_den <- subset(oysterraw_den_r_seed, oysterraw_den_r_seed$ProgramID != 5035)
oysterraw_den_r_seed_den <- subset(oysterraw_den_r_seed_den, oysterraw_den_r_seed_den$ProgramID != 5072)
oysterraw_den_r_seed_den[, meanDen_int := round(meanDen, digits = 0)]
den_25to75_sum <- summarySE(oysterraw_den_r_seed_den, measurevar = 'meanDen', groupvars = c('ManagedAreaName', 'LiveDate2'))
colnames(den_25to75_sum)[2] <- "Year"

#Summarize density data by managed area (mean density >= 75)
oysterraw_den_r_market <- readRDS(here::here('oysterraw_den_r_market.rds'))
#Need to remove HOBS data and 5072 data from density because density of DA not comparable to live density.
oysterraw_den_r_market_den <- subset(oysterraw_den_r_market, oysterraw_den_r_market$ProgramID != 5035)
oysterraw_den_r_market_den <- subset(oysterraw_den_r_market_den, oysterraw_den_r_market_den$ProgramID != 5072)
oysterraw_den_r_market_den[, meanDen_int := round(meanDen, digits = 0)]
den_o75_sum <- summarySE(oysterraw_den_r_market_den, measurevar = 'meanDen', groupvars = c('ManagedAreaName', 'LiveDate2'))
colnames(den_o75_sum)[2] <- "Year"

```

### Density data {.tabset .tabset-fade}

#### Raw density values

<br>

[Click here to view the oyster density data file.](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7B00D86C0C-3ECA-43F1-998C-8D2C0FD3EF46%7D&file=OysterDensity_AllDates.xlsx&action=default&mobileredirect=true)

```{r Density-data-raw, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_den, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:19), fontSize = '80%')

write.xlsx(oysterraw_den_nona, file = here::here("DocsForSMEs/OysterDensity_AllDates.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br>

#### Only 25-75mm shell height

<br>

This data file includes estimated density values of specimens between 25mm and 75mm shell height (i.e., seed size). The estimates were calculated by drawing random samples (without replacement) of n=20 from all samples of n>20 (samples were identified as a combination of the reefIDcrosswalk, QuadIdentifier, Year, and Month variables), then subsetting the random samples to just the specimens between 25 and 75mm in shell height (25mm <= x < 75mm) and storing the number of shells in the subsets as counts. This procedure was repeated 1000 times and then the 1000 count values for each sample were averaged.

[Click here to view the oyster density data file (25-75mm shell height).](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7B30CC7127-05B0-4B7D-9A5C-C56E729D75A2%7D&file=OysterDensity_AllDates_25to75mm.xlsx&action=default&mobileredirect=true)

```{r Density-data-25-75mm, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_den_r_seed_den, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:29), fontSize = '80%')

write.xlsx(oysterraw_den_r_seed_den, file = here::here("DocsForSMEs/OysterDensity_AllDates_25to75mm.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br>

#### Only >75mm shell height

<br>

This data file includes estimated density values of specimens >75mm shell height (i.e., market size). The estimates were calculated by drawing random samples (without replacement) of n=20 from all samples of n>20 (samples were identified as a combination of the reefIDcrosswalk, QuadIdentifier, Year, and Month variables), then subsetting the random samples to just the specimens >75mm in shell height (x >= 75mm) and storing the number of shells in the subsets as counts. This procedure was repeated 1000 times and then the 1000 count values for each sample were averaged.

[Click here to view the oyster density data file (>75mm shell height).](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7BB3AFC356-0642-4589-B3E5-D309F32082C0%7D&file=OysterDensity_AllDates_o75mm.xlsx&action=default&mobileredirect=true)

```{r Density-data-o75mm, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_den_r_market_den, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:29), fontSize = '80%')

write.xlsx(oysterraw_den_r_market_den, file = here::here("DocsForSMEs/OysterDensity_AllDates_o75mm.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br>


### Plot of density data availability {.tabset .tabset-fade}

#### Raw density values

```{r DenDataAvailabilityPlot-raw, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
Den_AllDates_DataAvailability_raw <- ggplot(den_all_sum, aes(x = Year, y = ManagedAreaName)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), shape = 21, fill = "navy blue", color = "black", alpha = 0.5)
Den_AllDates_DataAvailability_raw

ggsave(here::here(paste0("OA_plots/Den_AllDates_DataAvailability_raw_", Sys.Date(), ".jpeg")),
       Den_AllDates_DataAvailability_raw,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)
```

<br><br><br>

#### Only 25-75mm shell height (1950-2020)

```{r DenDataAvailabilityPlot-25-75mm, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
Den_AllDates_DataAvailability_25to75 <- ggplot(den_25to75_sum, aes(x = Year, y = ManagedAreaName)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), shape = 21, fill = "navy blue", color = "black", alpha = 0.5) +
  xlim(1950, 2020)
Den_AllDates_DataAvailability_25to75

ggsave(here::here(paste0("OA_plots/Den_AllDates_DataAvailability_25to75_", Sys.Date(), ".jpeg")),
       Den_AllDates_DataAvailability_25to75,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)
```

<br><br><br>

#### Only >75mm shell height (1950-2020)

```{r DenDataAvailabilityPlot-o75mm, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
Den_AllDates_DataAvailability_o75 <- ggplot(den_o75_sum, aes(x = Year, y = ManagedAreaName)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), shape = 21, fill = "navy blue", color = "black", alpha = 0.5) +
  xlim(1950, 2020)
Den_AllDates_DataAvailability_o75

ggsave(here::here(paste0("OA_plots/Den_AllDates_DataAvailability_o75_", Sys.Date(), ".jpeg")),
       Den_AllDates_DataAvailability_o75,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)
```

<br><br><br>

### Density summary table {.tabset .tabset-fade}

#### Raw density values

```{r DenSummaryTable-raw, echo=TRUE, message=FALSE, warning=FALSE}
#Create summary table showing number of reefs/programs of data included in oysterraw_den
oysterraw_den_nona[, nReefsbyMAandYr := length(unique(reefIDcrosswalk)), by = c('MA_plotlab', 'Year')]
oysterraw_den_nona[, nProgsbyMAandYr := length(unique(ProgramID)), by = c('MA_plotlab', 'Year')]
oysterraw_den_nona[, ProgsbyMAandYr := list(list(unique(ProgramID))), by = c('MA_plotlab', 'Year')]
oysterraw_den_nona[, nProgsbyMA := length(unique(ProgramID)), by = 'MA_plotlab']
oysterraw_den_nona[, ProgsbyMA := list(list(unique(ProgramID))), by = 'MA_plotlab']

den_sum1 <- unique(oysterraw_den_nona[, .(MA_plotlab, Year, nReefsbyMAandYr, nProgsbyMAandYr, nProgsbyMA)], by = c('MA_plotlab', 'Year', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'nProgsbyMA'))
listcols <- oysterraw_den_nona[, .SD[1], by = c('MA_plotlab', 'Year')][, .(ProgsbyMAandYr, ProgsbyMA)]
den_sum1 <- cbind(den_sum1, listcols)
setcolorder(den_sum1, c('MA_plotlab', 'nProgsbyMA', 'ProgsbyMA', 'Year', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'))
setorder(den_sum1, MA_plotlab, Year)

#Create easily readable table in knitted document
#Better column names
den_sum1_renamed <- setnames(den_sum1, c('nProgsbyMA', 'ProgsbyMA', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups <- c()
for(i in unique(den_sum1$MA_plotlab)){
  name <- paste0(i, ", Total Programs = ", den_sum1[MA_plotlab == i, 2][1], ": ", den_sum1[MA_plotlab == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
den_sum1[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay_Natural, Total Programs = 2: c(5063, 5073)" = length(subset(den_sum1, den_sum1$MA_plotlab == "Apalachicola Bay_Natural")$Year),
                      "Apalachicola Bay_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(den_sum1, den_sum1$MA_plotlab == "Apalachicola Bay_Restored")$Year),
                      "Apalachicola NERR_Natural, Total Programs = 3: c(5063, 5073, 5075)" = length(subset(den_sum1, den_sum1$MA_plotlab == "Apalachicola NERR_Natural")$Year),
                      "Apalachicola NERR_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(den_sum1, den_sum1$MA_plotlab == "Apalachicola NERR_Restored")$Year),
                      "Boca Ciega Bay_Natural, Total Programs = 1: 4020" = length(subset(den_sum1, den_sum1$MA_plotlab == "Boca Ciega Bay_Natural")$Year), 
                      "Estero Bay_Natural, Total Programs = 1: 4042" = length(subset(den_sum1, den_sum1$MA_plotlab == "Estero Bay_Natural")$Year),
                      "Estero Bay_Restored, Total Programs = 1: 4012" = length(subset(den_sum1, den_sum1$MA_plotlab == "Estero Bay_Restored")$Year),
                      "Guana River Marsh_Natural, Total Programs = 2: c(4000, 5017)" = length(subset(den_sum1, den_sum1$MA_plotlab == "Guana River Marsh_Natural")$Year),  
                      "Guana Tolomato Matanzas NERR_Natural, Total Programs = 2: c(4000, 5017)" = length(subset(den_sum1, den_sum1$MA_plotlab == "Guana Tolomato Matanzas NERR_Natural")$Year), 
                      "Indian River-Malabar to Vero Beach_Natural, Total Programs = 1: 4016" = length(subset(den_sum1, den_sum1$MA_plotlab == "Indian River-Malabar to Vero Beach_Natural")$Year), 
                      "Indian River-Vero Beach to Ft. Pierce_Natural, Total Programs = 1: 4016)" = length(subset(den_sum1, den_sum1$MA_plotlab == "Indian River-Vero Beach to Ft. Pierce_Natural")$Year), 
                      "Jensen Beach to Jupiter Inlet_Natural, Total Programs = 1: 4016" = length(subset(den_sum1, den_sum1$MA_plotlab == "Jensen Beach to Jupiter Inlet_Natural")$Year),
                      "Lemon Bay_Natural, Total Programs = 1: 972" = length(subset(den_sum1, den_sum1$MA_plotlab == "Lemon Bay_Natural")$Year), 
                      "Loxahatchee River-Lake Worth Creek_Natural, Total Programs = 1: 4014" = length(subset(den_sum1, den_sum1$MA_plotlab == "Loxahatchee River-Lake Worth Creek_Natural")$Year),
                      "Mosquito Lagoon_Natural, Total Programs = 1: 5017" = length(subset(den_sum1, den_sum1$MA_plotlab == "Mosquito Lagoon_Natural")$Year),  
                      "Nassau River-St. Johns River Marshes_Natural, Total Programs = 1: 5017" = length(subset(den_sum1, den_sum1$MA_plotlab == "Nassau River-St. Johns River Marshes_Natural")$Year), 
                      #"Pellicer Creek, Total Programs = 2: c(4000, 5017)" = length(subset(den_sum1, den_sum1$MA_plotlab == "Pellicer Creek")$Year), #No samples from within AP, though there are plenty within Pellicer Flats region of GTMNERR.
                      "Pine Island Sound_Natural, Total Programs = 1: 4012" = length(subset(den_sum1, den_sum1$MA_plotlab == "Pine Island Sound_Natural")$Year),
                      "Pine Island Sound_Restored, Total Programs = 1: 4012" = length(subset(den_sum1, den_sum1$MA_plotlab == "Pine Island Sound_Restored")$Year),
                      "Pinellas County_Natural, Total Programs = 1: 4020" = length(subset(den_sum1, den_sum1$MA_plotlab == "Pinellas County_Natural")$Year),  
                      "St. Martins Marsh_Natural, Total Programs = 1: 5074" = length(subset(den_sum1, den_sum1$MA_plotlab == "St. Martins Marsh_Natural")$Year), 
                      "Tomoka Marsh_Natural, Total Programs = 1: 5017" = length(subset(den_sum1, den_sum1$MA_plotlab == "Tomoka Marsh_Natural")$Year),
                      "Yellow River Marsh_Natural, Total Programs = 1: 5073" = length(subset(den_sum1, den_sum1$MA_plotlab == "Yellow River Marsh_Natural")$Year),
                      "Yellow River Marsh_Restored, Total Programs = 1: 4044" = length(subset(den_sum1, den_sum1$MA_plotlab == "Yellow River Marsh_Restored")$Year)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")
```

<br><br><br>

#### Only 25-75mm shell height

```{r DenSummaryTable-25-75mm, echo=TRUE, message=FALSE, warning=FALSE}
#Create summary table showing number of reefs/programs of data included in oysterraw_den_r_seed_den
oysterraw_den_r_seed_den[, nReefsbyMAandYr := length(unique(reefIDcrosswalk)), by = c('MA_plotlab', 'LiveDate2')]
oysterraw_den_r_seed_den[, nProgsbyMAandYr := length(unique(ProgramID)), by = c('MA_plotlab', 'LiveDate2')]
oysterraw_den_r_seed_den[, ProgsbyMAandYr := list(list(unique(ProgramID))), by = c('MA_plotlab', 'LiveDate2')]
oysterraw_den_r_seed_den[, nProgsbyMA := length(unique(ProgramID)), by = 'MA_plotlab']
oysterraw_den_r_seed_den[, ProgsbyMA := list(list(unique(ProgramID))), by = 'MA_plotlab']

den_sum1_seed <- unique(oysterraw_den_r_seed_den[, .(MA_plotlab, LiveDate2, nReefsbyMAandYr, nProgsbyMAandYr, nProgsbyMA)], by = c('MA_plotlab', 'LiveDate2', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'nProgsbyMA'))
listcols <- oysterraw_den_r_seed_den[, .SD[1], by = c('MA_plotlab', 'LiveDate2')][, .(ProgsbyMAandYr, ProgsbyMA)]
den_sum1_seed <- cbind(den_sum1_seed, listcols)
setcolorder(den_sum1_seed, c('MA_plotlab', 'nProgsbyMA', 'ProgsbyMA', 'LiveDate2', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'))
setorder(den_sum1_seed, MA_plotlab, LiveDate2)

archeoyrs <- c(167, 382, 644, 892)
den_sum1_seed[, nReefsbyMAandYr := as.character(nReefsbyMAandYr)]
den_sum1_seed[LiveDate2 %in% archeoyrs, nReefsbyMAandYr := "Unknown"]


#Create easily readable table in knitted document
#Better column names
den_sum1_seed_renamed <- setnames(den_sum1_seed, c('nProgsbyMA', 'ProgsbyMA', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups <- c()
for(i in unique(den_sum1_seed$MA_plotlab)){
  name <- paste0(i, ", Total Programs = ", den_sum1_seed[MA_plotlab == i, 2][1], ": ", den_sum1_seed[MA_plotlab == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
den_sum1_seed[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay_Natural, Total Programs = 3: c(5063, 5071, 5073)" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Apalachicola Bay_Natural")$LiveDate2),
                      "Apalachicola Bay_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Apalachicola Bay_Restored")$LiveDate2),
                      "Apalachicola NERR_Natural, Total Programs = 4: c(5063, 5071, 5073, 5075)" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Apalachicola NERR_Natural")$LiveDate2),
                      "Apalachicola NERR_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Apalachicola NERR_Restored")$LiveDate2),
                      "Boca Ciega Bay_Natural, Total Programs = 1: 4020" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Boca Ciega Bay_Natural")$LiveDate2),
                      "Estero Bay_Natural, Total Programs = 1: 4042" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Estero Bay_Natural")$LiveDate2),
                      "Estero Bay_Restored, Total Programs = 1: 4012" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Estero Bay_Restored")$LiveDate2),
                      "Guana River Marsh_Natural, Total Programs = 2: c(4000, 5017)" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Guana River Marsh_Natural")$LiveDate2),  
                      "Guana Tolomato Matanzas NERR_Natural, Total Programs = 2: c(4000, 5017)" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Guana Tolomato Matanzas NERR_Natural")$LiveDate2), 
                      "Indian River-Malabar to Vero Beach_Natural, Total Programs = 1: 4016" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Indian River-Malabar to Vero Beach_Natural")$LiveDate2), 
                      "Indian River-Vero Beach to Ft. Pierce_Natural, Total Programs = 1: 4016" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Indian River-Vero Beach to Ft. Pierce_Natural")$LiveDate2), 
                      "Jensen Beach to Jupiter Inlet_Natural, Total Programs = 1: 4016" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Jensen Beach to Jupiter Inlet_Natural")$LiveDate2),
                      "Loxahatchee River-Lake Worth Creek_Natural, Total Programs = 1: 4014" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Loxahatchee River-Lake Worth Creek_Natural")$LiveDate2),
                      "Mosquito Lagoon_Natural, Total Programs = 1: 5017" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Mosquito Lagoon_Natural")$LiveDate2),  
                      "Nassau River-St. Johns River Marshes_Natural, Total Programs = 1: 5017" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Nassau River-St. Johns River Marshes_Natural")$LiveDate2), 
                      #"Nature Coast, Total Programs = 1: 5070" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Nature Coast")$LiveDate2),  
                      "Pine Island Sound_Natural, Total Programs = 1: 4012" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Pine Island Sound_Natural")$LiveDate2),
                      "Pine Island Sound_Restored, Total Programs = 1: 4012" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Pine Island Sound_Restored")$LiveDate2),
                      "Pinellas County_Natural, Total Programs = 1: 4020" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Pinellas County_Natural")$LiveDate2),  
                      "St. Martins Marsh_Natural, Total Programs = 2: c(5070, 5074)" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "St. Martins Marsh_Natural")$LiveDate2),
                      "Yellow River Marsh_Restored, Total Programs = 1: 4044" = length(subset(den_sum1_seed, den_sum1_seed$MA_plotlab == "Yellow River Marsh_Restored")$LiveDate2)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")
```

<br><br><br>

#### Only >75mm shell height

```{r DenSummaryTable-o75mm, echo=TRUE, message=FALSE, warning=FALSE}
#Create summary table showing number of reefs/programs of data included in oysterraw_den_r_market_den
oysterraw_den_r_market_den[, nReefsbyMAandYr := length(unique(reefIDcrosswalk)), by = c('MA_plotlab', 'LiveDate2')]
oysterraw_den_r_market_den[, nProgsbyMAandYr := length(unique(ProgramID)), by = c('MA_plotlab', 'LiveDate2')]
oysterraw_den_r_market_den[, ProgsbyMAandYr := list(list(unique(ProgramID))), by = c('MA_plotlab', 'LiveDate2')]
oysterraw_den_r_market_den[, nProgsbyMA := length(unique(ProgramID)), by = 'MA_plotlab']
oysterraw_den_r_market_den[, ProgsbyMA := list(list(unique(ProgramID))), by = 'MA_plotlab']

den_sum1_market <- unique(oysterraw_den_r_market_den[, .(MA_plotlab, LiveDate2, nReefsbyMAandYr, nProgsbyMAandYr, nProgsbyMA)], by = c('MA_plotlab', 'LiveDate2', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'nProgsbyMA'))
listcols <- oysterraw_den_r_market_den[, .SD[1], by = c('MA_plotlab', 'LiveDate2')][, .(ProgsbyMAandYr, ProgsbyMA)]
den_sum1_market <- cbind(den_sum1_market, listcols)
setcolorder(den_sum1_market, c('MA_plotlab', 'nProgsbyMA', 'ProgsbyMA', 'LiveDate2', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'))
setorder(den_sum1_market, MA_plotlab, LiveDate2)

archeoyrs <- c(167, 382, 644, 892)
den_sum1_market[, nReefsbyMAandYr := as.character(nReefsbyMAandYr)]
den_sum1_market[LiveDate2 %in% archeoyrs, nReefsbyMAandYr := "Unknown"]

#Create easily readable table in knitted document
#Better column names
den_sum1_market_renamed <- setnames(den_sum1_market, c('nProgsbyMA', 'ProgsbyMA', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups <- c()
for(i in unique(den_sum1_market$MA_plotlab)){
  name <- paste0(i, ", Total Programs = ", den_sum1_market[MA_plotlab == i, 2][1], ": ", den_sum1_market[MA_plotlab == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
den_sum1_market[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay_Natural, Total Programs = 3: c(5063, 5071, 5073)" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Apalachicola Bay_Natural")$LiveDate2),
                      "Apalachicola Bay_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Apalachicola Bay_Restored")$LiveDate2),
                      "Apalachicola NERR_Natural, Total Programs = 4: c(5063, 5071, 5073, 5075)" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Apalachicola NERR_Natural")$LiveDate2),
                      "Apalachicola NERR_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Apalachicola NERR_Restored")$LiveDate2),
                      "Boca Ciega Bay_Natural, Total Programs = 1: 4020" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Boca Ciega Bay_Natural")$LiveDate2),
                      "Estero Bay_Natural, Total Programs = 1: 4042" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Estero Bay_Natural")$LiveDate2),
                      "Estero Bay_Restored, Total Programs = 1: 4012" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Estero Bay_Restored")$LiveDate2),
                      "Guana River Marsh_Natural, Total Programs = 2: c(4000, 5017)" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Guana River Marsh_Natural")$LiveDate2),  
                      "Guana Tolomato Matanzas NERR_Natural, Total Programs = 2: c(4000, 5017)" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Guana Tolomato Matanzas NERR_Natural")$LiveDate2), 
                      "Indian River-Malabar to Vero Beach_Natural, Total Programs = 1: 4016" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Indian River-Malabar to Vero Beach_Natural")$LiveDate2), 
                      "Indian River-Vero Beach to Ft. Pierce_Natural, Total Programs = 1: 4016" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Indian River-Vero Beach to Ft. Pierce_Natural")$LiveDate2), 
                      "Jensen Beach to Jupiter Inlet_Natural, Total Programs = 1: 4016" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Jensen Beach to Jupiter Inlet_Natural")$LiveDate2),
                      "Loxahatchee River-Lake Worth Creek_Natural, Total Programs = 1: 4014" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Loxahatchee River-Lake Worth Creek_Natural")$LiveDate2),
                      "Mosquito Lagoon_Natural, Total Programs = 1: 5017" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Mosquito Lagoon_Natural")$LiveDate2),  
                      "Nassau River-St. Johns River Marshes_Natural, Total Programs = 1: 5017" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Nassau River-St. Johns River Marshes_Natural")$LiveDate2), 
                      #"Nature Coast, Total Programs = 1: 5070" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Nature Coast")$LiveDate2),  
                      "Pine Island Sound_Natural, Total Programs = 1: 4012" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Pine Island Sound_Natural")$LiveDate2),
                      "Pine Island Sound_Restored, Total Programs = 1: 4012" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Pine Island Sound_Restored")$LiveDate2),
                      "Pinellas County_Natural, Total Programs = 1: 4020" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Pinellas County_Natural")$LiveDate2),  
                      "St. Martins Marsh_Natural, Total Programs = 2: c(5070, 5074)" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "St. Martins Marsh_Natural")$LiveDate2),
                      "Yellow River Marsh_Restored, Total Programs = 1: 4044" = length(subset(den_sum1_market, den_sum1_market$MA_plotlab == "Yellow River Marsh_Restored")$LiveDate2)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")
```

<br><br><br>

### Density box plots {.tabset .tabset-fade}

#### Raw density values

```{r boxplots-den-raw, echo=TRUE, fig.height=20, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
#Box plots of density by year, by managed area
#oysterraw_den_nona[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
oysterraw_den_nona[, YrHC := paste0(Year, "_", HabitatClassification)]
Den_AllDates_BoxplotByYr_raw <- ggplot(oysterraw_den_nona, aes(x = Year, y = Density_m2, group = YrHC, fill = HabitatClassification)) +
  geom_boxplot() + #color = 'black', fill = 'light blue'
  facet_wrap(~ ManagedAreaName, ncol = 3, scales = 'free') + 
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  #scale_x_continuous(limits = c(2007, 2020)) +
  #scale_y_continuous(limits = c(70, 175)) +
  coord_cartesian(xlim = c(2003, 2020)) +
  labs(fill = "Habitat Classification")
Den_AllDates_BoxplotByYr_raw

ggsave(here::here(paste0("OA_plots/Den_AllDates_BoxplotByYr_raw_", Sys.Date(), ".jpeg")),
       Den_AllDates_BoxplotByYr_raw,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

```{r AvgDenLive-setup-raw, message=FALSE, warning=FALSE, include=FALSE}
#Density, all and by reef
den_avg_all <- oysterraw_den_nona[, MeanDen := mean(Density_m2), by = c('ManagedAreaName', 'Year')][, sdDen := sd(Density_m2), by = c('Year', 'ManagedAreaName')][, semDen := sd(Density_m2)/sqrt(length(Density_m2)), by = c('Year', 'ManagedAreaName')][, nYears := length(unique(Year)), by = c('ManagedAreaName')][, MeanReefDen := mean(Density_m2), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefDen := sd(Density_m2), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefDen := sd(Density_m2)/sqrt(length(Density_m2)), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef := length(unique(Year)), by = c('ManagedAreaName', 'reefIDcrosswalk')]

#den_avg_reef <- unique(den_avg_all[, c(1:2, 8, 10, 12:15, 20, 22, 29:32)])
den_avg_reef <- unique(den_avg_all[, c("ProgramID", "ProgramName", "Year", "ManagedAreaName", "SurveyMethod", "HabitatClassification", "QuadSize_m2", "MADup", "reefIDcrosswalk", "MA_plotlab", "MeanReefDen", "sdReefDen", "semReefDen", "nYearsReef")])

```

<br><br><br>

#### Only 25-75mm shell height

```{r boxplots-den-25to75mm, echo=TRUE, fig.height=20, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
#Box plots of density by year, by managed area
#oysterraw_den_r_seed_den[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
oysterraw_den_r_seed_den[, YrHC := paste0(Year, "_", HabitatClassification)]
Den_AllDates_BoxplotByYr_25to75 <- ggplot(oysterraw_den_r_seed_den, aes(x = LiveDate2, y = meanDen, group = YrHC, fill = HabitatClassification)) +
  geom_boxplot() + #color = 'black', fill = 'light blue'
  facet_wrap(~ ManagedAreaName, ncol = 3, scales = 'free') + 
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  #scale_x_continuous(limits = c(2007, 2020)) +
  #scale_y_continuous(limits = c(70, 175)) +
  coord_cartesian(xlim = c(2007, 2020)) +
  labs(fill = "Habitat Classification")
Den_AllDates_BoxplotByYr_25to75

ggsave(here::here(paste0("OA_plots/Den_AllDates_BoxplotByYr_25to75_", Sys.Date(), ".jpeg")),
       Den_AllDates_BoxplotByYr_25to75,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

```{r AvgDenLive-setup-25to75mm, message=FALSE, warning=FALSE, include=FALSE}
#Density, seed size and by reef
den_avg_seed_all <- oysterraw_den_r_seed_den[, MeanDen := mean(meanDen), by = c('ManagedAreaName', 'LiveDate2')][, sdDen := sd(meanDen), by = c('LiveDate2', 'ManagedAreaName')][, semDen := sd(meanDen)/sqrt(length(meanDen)), by = c('LiveDate2', 'ManagedAreaName')][, nYears := length(unique(LiveDate2)), by = c('ManagedAreaName')][, MeanReefDen := mean(meanDen), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefDen := sd(meanDen), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefDen := sd(meanDen)/sqrt(length(meanDen)), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef := length(unique(LiveDate2)), by = c('ManagedAreaName', 'reefIDcrosswalk')]
den_avg_seed_reef <- unique(den_avg_seed_all[, c(1:2, 14, 16:21, 23:25, 42:45)])

```

<br><br><br>

#### Only >75mm shell height

```{r boxplots-den-o75mm, echo=TRUE, fig.height=20, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
#Box plots of density by year, by managed area
#oysterraw_den_r_market_den[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
oysterraw_den_r_market_den[, YrHC := paste0(Year, "_", HabitatClassification)]
Den_AllDates_BoxplotByYr_o75 <- ggplot(oysterraw_den_r_market_den, aes(x = LiveDate2, y = meanDen, group = YrHC, fill = HabitatClassification)) +
  geom_boxplot() + #color = 'black', fill = 'light blue'
  facet_wrap(~ ManagedAreaName, ncol = 3, scales = 'free') + 
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  #scale_x_continuous(limits = c(2007, 2020)) +
  #scale_y_continuous(limits = c(70, 175)) +
  coord_cartesian(xlim = c(2007, 2020)) +
  labs(fill = "Habitat Classification")
Den_AllDates_BoxplotByYr_o75

ggsave(here::here(paste0("OA_plots/Den_AllDates_BoxplotByYr_o75_", Sys.Date(), ".jpeg")),
       Den_AllDates_BoxplotByYr_o75,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

```{r AvgDenLive-setup-o75mm, message=FALSE, warning=FALSE, include=FALSE}
#Density, market size and by reef
den_avg_market_all <- oysterraw_den_r_market_den[, MeanDen := mean(meanDen), by = c('ManagedAreaName', 'LiveDate2')][, sdDen := sd(meanDen), by = c('LiveDate2', 'ManagedAreaName')][, semDen := sd(meanDen)/sqrt(length(meanDen)), by = c('LiveDate2', 'ManagedAreaName')][, nYears := length(unique(LiveDate2)), by = c('ManagedAreaName')][, MeanReefDen := mean(meanDen), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefDen := sd(meanDen), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefDen := sd(meanDen)/sqrt(length(meanDen)), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef := length(unique(LiveDate2)), by = c('ManagedAreaName', 'reefIDcrosswalk')]
den_avg_market_reef <- unique(den_avg_market_all[, c(1:2, 14, 16:21, 23:25, 42:45)])

```

<br><br><br>

***

## Percent live

```{r Percent-live-data-setup-and-summarize, echo=TRUE, message=FALSE, warning=FALSE}

setDT(oysterraw_pct)
# oysterraw_pct <- oysterraw_pct %>% mutate(SampleDate = mdy_hms(SampleDate))
# oysterraw_pct[, Month := month(SampleDate)]
# oysterraw_pct[, YrMo := paste0(Year, "-", Month)]
# oysterraw_pct[PercentLiveMethod == "Point-Intercept", PercentLiveMethod := "Point-intercept"]

#More complicated conversion of date columns needed because ID_972 data do not have the hms format for time like the default in the combined table exports. When it eventually is corrected and fixed in the combined table export, then all program data should have the same SampleDate format and the above code should work again.
oysterraw_pct_no972 <- setDT(subset(oysterraw_pct, oysterraw_pct$ProgramID != 972)) %>% mutate(SampleDate = mdy_hms(SampleDate))
oysterraw_pct_no972[, Month := month(SampleDate)]
oysterraw_pct_no972[, YrMo := paste0(Year, "-", Month)]

oysterraw_pct_972 <- setDT(subset(oysterraw_pct, oysterraw_pct$ProgramID == 972)) %>% mutate(SampleDate = mdy_hm(SampleDate))
oysterraw_pct_972[, Month := month(SampleDate)]
oysterraw_pct_972[, YrMo := paste0(Year, "-", Month)]

oysterraw_pct <- rbind(oysterraw_pct_no972, oysterraw_pct_972)


#Fix QuadID and ReefID columns for 2003 data in program 4014
Reefs_4014_2003 <- c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13')
Quads_4014_2003 <- c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '13', '14')
Fix4014 <- oysterraw_pct[ProgramID == 4014, ][Year == 2003, QuadIdentifier := Quads_4014_2003][Year == 2003, ReefIdentifier := Reefs_4014_2003]
no4014 <- subset(oysterraw_pct, oysterraw_pct$ProgramID != 4014)
oysterraw_pct <- rbind(Fix4014, no4014)

#Fix HabitatClassification of 4012
oysterraw_pct[QuadIdentifier %like% "_Ref", HabitatClassification := "Natural"]
oysterraw_pct[QuadIdentifier %like% "_C", HabitatClassification := "Natural"]

saveRDS(oysterraw_pct, here::here("oysterraw_pct.rds"))

#Summarize percent live data by managed area
oysterraw_pct_nona <- subset(oysterraw_pct, !is.na(oysterraw_pct$PercentLive_pct))
oysterraw_pct_nona[ProgramID == 4012, PercentLiveMethod := "Percent"]
oysterraw_pct_nona[PercentLiveMethod == "percent", PercentLiveMethod := "Percent"]
oysterraw_pct_nona[, Year := as.integer(Year)]
pct_all_sum <- summarySE(oysterraw_pct_nona, measurevar = 'PercentLive_pct', groupvars = c('ManagedAreaName', 'Year', 'PercentLiveMethod'))
```

### Percent live data

<br>

[Click here to view the oyster percent live data file.](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7B854CF490-7E81-4EE1-8879-569D4AAFA412%7D&file=OysterPercentLive_AllDates.xlsx&action=default&mobileredirect=true)

```{r Percent-live-data, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_pct, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:19), fontSize = '80%')

write.xlsx(oysterraw_pct_nona, file = here::here("DocsForSMEs/OysterPercentLive_AllDates.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br>

### Plot of percent live data availability

```{r PctLive-All-DotPlot, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
Pct_AllDates_DataAvailability_raw <- ggplot(pct_all_sum, aes(x = Year, y = ManagedAreaName, fill = PercentLiveMethod)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), color = "black", shape = 21, alpha = 0.5) + #fill = "navy blue",  
  xlim(1950, 2020)
Pct_AllDates_DataAvailability_raw

ggsave(here::here(paste0("OA_plots/Pct_AllDates_DataAvailability_raw_", Sys.Date(), ".jpeg")),
       Pct_AllDates_DataAvailability_raw,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)
```

<br><br><br>

### Percent live summary table

```{r PctSummaryTable, echo=TRUE, message=FALSE, warning=FALSE}
#Create summary table showing number of reefs/programs of data included in oysterraw_pct_nona
oysterraw_pct_nona[, nReefsbyMAandYr := length(unique(reefIDcrosswalk)), by = c('MA_plotlab', 'Year')]
oysterraw_pct_nona[, nProgsbyMAandYr := length(unique(ProgramID)), by = c('MA_plotlab', 'Year')]
oysterraw_pct_nona[, ProgsbyMAandYr := list(list(unique(ProgramID))), by = c('MA_plotlab', 'Year')]
oysterraw_pct_nona[, nProgsbyMA := length(unique(ProgramID)), by = 'MA_plotlab']
oysterraw_pct_nona[, ProgsbyMA := list(list(unique(ProgramID))), by = 'MA_plotlab']

pct_sum1 <- unique(oysterraw_pct_nona[, .(MA_plotlab, Year, nReefsbyMAandYr, nProgsbyMAandYr, nProgsbyMA)], by = c('MA_plotlab', 'Year', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'nProgsbyMA'))
listcols <- oysterraw_pct_nona[, .SD[1], by = c('MA_plotlab', 'Year')][, .(ProgsbyMAandYr, ProgsbyMA)]
pct_sum1 <- cbind(pct_sum1, listcols)
setcolorder(pct_sum1, c('MA_plotlab', 'nProgsbyMA', 'ProgsbyMA', 'Year', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'))
setorder(pct_sum1, MA_plotlab, Year)

#Create easily readable table in knitted document
#Better column names
pct_sum1_renamed <- setnames(pct_sum1, c('nProgsbyMA', 'ProgsbyMA', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups <- c()
for(i in unique(pct_sum1$MA_plotlab)){
  name <- paste0(i, ", Total Programs = ", pct_sum1[MA_plotlab == i, 2][1], ": ", pct_sum1[MA_plotlab == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
pct_sum1[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay_Natural, Total Programs = 1: 5010" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Apalachicola Bay_Natural")$Year),
                      "Apalachicola Bay_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Apalachicola Bay_Restored")$Year),
                      "Apalachicola NERR_Natural, Total Programs = 1: 5010" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Apalachicola NERR_Natural")$Year),
                      "Apalachicola NERR_Restored, Total Programs = 2: c(4044, 5007)" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Apalachicola NERR_Restored")$Year),
                      "Boca Ciega Bay_Natural, Total Programs = 1: 4020" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Boca Ciega Bay_Natural")$Year), 
                      "Estero Bay_Natural, Total Programs = 1: 4042" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Estero Bay_Natural")$Year),
                      "Estero Bay_Restored, Total Programs = 1: 4012" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Estero Bay_Restored")$Year),
                      "Guana River Marsh_Natural, Total Programs = 2: c(4000, 5017)" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Guana River Marsh_Natural")$Year),  
                      "Guana Tolomato Matanzas NERR_Natural, Total Programs = 2: c(4000, 5017)" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Guana Tolomato Matanzas NERR_Natural")$Year), 
                      "Indian River-Malabar to Vero Beach_Natural, Total Programs = 1: 4016" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Indian River-Malabar to Vero Beach_Natural")$Year), 
                      "Indian River-Vero Beach to Ft. Pierce_Natural, Total Programs = 1: 4016" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Indian River-Vero Beach to Ft. Pierce_Natural")$Year), 
                      "Jensen Beach to Jupiter Inlet_Natural, Total Programs = 1: 4016" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Jensen Beach to Jupiter Inlet_Natural")$Year),
                      "Lemon Bay_Natural, Total Programs = 1: 972" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Lemon Bay_Natural")$Year), 
                      "Loxahatchee River-Lake Worth Creek_Natural, Total Programs = 1: 4014" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Loxahatchee River-Lake Worth Creek_Natural")$Year),
                      "Mosquito Lagoon_Natural, Total Programs = 1: 5017" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Mosquito Lagoon_Natural")$Year),  
                      "Nassau River-St. Johns River Marshes_Natural, Total Programs = 1: 5017" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Nassau River-St. Johns River Marshes_Natural")$Year), 
                      "Pine Island Sound_Natural, Total Programs = 1: 4012" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Pine Island Sound_Natural")$Year),
                      "Pine Island Sound_Restored, Total Programs = 1: 4012" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Pine Island Sound_Restored")$Year),
                      "Pinellas County_Natural, Total Programs = 1: 4020" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Pinellas County_Natural")$Year),  
                      "St. Martins Marsh_Natural, Total Programs = 1: 5074" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "St. Martins Marsh_Natural")$Year), 
                      "Tomoka Marsh_Natural, Total Programs = 1: 5017" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Tomoka Marsh_Natural")$Year),
                      "Yellow River Marsh_Restored, Total Programs = 1: 4044" = length(subset(pct_sum1, pct_sum1$MA_plotlab == "Yellow River Marsh_Restored")$Year)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")

```  

<br><br><br>

### Percent live boxplots

```{r PctLivebyYear-boxplots, echo=TRUE, message=FALSE, warning=FALSE, fig.height=20, fig.width=10, out.width="100%"}
#Box plots of percent live by year, by managed area
oysterraw_pct_nona[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
oysterraw_pct_nona[, Yr_PLM := paste0(Year, "_", PercentLiveMethod)]
Pct_AllDates_BoxplotByYr_raw <- ggplot(oysterraw_pct_nona, aes(x = Year, y = PercentLive_pct, group = Yr_PLM, fill = PercentLiveMethod)) +
  geom_boxplot() + #color = 'black', fill = 'light blue'
  facet_wrap(~ MA_plotlab, ncol = 3, scales = 'free') + 
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2002, 2021)) +
  #scale_y_continuous(limits = c(70, 175)) +
  #coord_cartesian(xlim = c(2007, 2020)) +
  labs(fill = "Percent Live Method")
Pct_AllDates_BoxplotByYr_raw

ggsave(here::here(paste0("OA_plots/Pct_AllDates_BoxplotByYr_raw_", Sys.Date(), ".jpeg")),
       Pct_AllDates_BoxplotByYr_raw,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

```{r AvgPctLive-setup, echo=TRUE, message=FALSE, warning=FALSE}
#Pct live, all and by reef
pct_avg_all <- oysterraw_pct_nona[, MeanPct := mean(PercentLive_pct), by = c('ManagedAreaName', 'Year')][, sdPct := sd(PercentLive_pct), by = c('Year', 'ManagedAreaName')][, semPct := sd(PercentLive_pct)/sqrt(length(PercentLive_pct)), by = c('Year', 'ManagedAreaName')][, nYears := length(unique(Year)), by = c('ManagedAreaName')][, MeanReefPct := mean(PercentLive_pct), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefPct := sd(PercentLive_pct), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefPct := sd(PercentLive_pct)/sqrt(length(PercentLive_pct)), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef := length(unique(Year)), by = c('ManagedAreaName', 'reefIDcrosswalk')][, YrMo := format(as.Date(SampleDate), "%Y-%m")][, MeanReefPct_yrmo := mean(PercentLive_pct), by = c('YrMo', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefPct_yrmo := sd(PercentLive_pct), by = c('YrMo', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefPct_yrmo := sd(PercentLive_pct)/sqrt(length(PercentLive_pct)), by = c('YrMo', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef_yrmo := length(unique(YrMo)), by = c('ManagedAreaName', 'reefIDcrosswalk')]
#pct_avg_reef <- unique(pct_avg_all[, c(1:2, 7:8, 10, 12:16, 21:23, 28:31)])
#pct_avg_reef_yr <- unique(pct_avg_all[, c(1:2, 8, 10, 12:16, 21:24, 30:33)])
pct_avg_reef_yr <- unique(pct_avg_all[, c("ProgramID", "ProgramName", "Year", "ManagedAreaName", "SurveyMethod", "PercentLiveMethod", "HabitatClassification", "QuadSize_m2", "MADup", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal", "MeanReefPct", "sdReefPct", "semReefPct", "nYearsReef")])
#pct_avg_reef_yrmo <- unique(pct_avg_all[, c(1:2, 8, 10, 12:16, 21:24, 34:37)])
pct_avg_reef_yrmo <- unique(pct_avg_all[, c("ProgramID", "ProgramName", "Year", "ManagedAreaName", "SurveyMethod", "PercentLiveMethod", "HabitatClassification", "QuadSize_m2", "MADup", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal", "MeanReefPct_yrmo", "sdReefPct_yrmo", "semReefPct_yrmo", "nYearsReef_yrmo")])

```

<br><br><br>

***

# Non-recruitment Sample Dates Only

```{r}
#Add a column for season (initially chosen to allow isolating the Jan-Mar non-recruitment season based on Steve Geiger's recommendation, but there was < 5 years of data for all managed areas for shell height and percent live, and only one managed area with at least 5 years of data for density when using those criteria, so I tried November to March instead, which is the non-recruitment season recommended by Nikki Dix.)
#oysterraw_nr <- oysterraw[, JantoMar := ifelse(Month == 1 | Month == 2 | Month == 3, 1, 0)]
#oysterraw <- oysterraw_nr[JantoMar == 1, ]
hist_lb <- c("8876", "8877", "8878", "8879", "8880", "8881", "8882")
oysterraw[ProgramLocationID %in% hist_lb, Month := "10"]

oysterraw_nr <- oysterraw[, NovtoMar := ifelse(Month == 11 | Month == 12 | Month == 1 | Month == 2 | Month == 3, 1, 0)]
oysterraw_nr <- oysterraw_nr[NovtoMar == 1, ]
```

```{r Indicator-data-subsets-nr, echo=TRUE, message = FALSE, warning = FALSE}
# Separate oyster data into broad categories by indicator

#Reformat dataframe so that metadata rows are not duplicated for each data column. Based on solution posted here: https://stackoverflow.com/questions/54132853/how-to-collapse-a-dataframe-with-duplicate-ids-and-varying-missing-values-per-id


#oysterraw_sh_nr <- oysterraw_nr[, c(2:24, 27, 32:35)] %>%
oysterraw_sh_nr <- oysterraw_nr[, c("ProgramID", "ProgramName", "ProgramLocationID", "QuadIdentifier", "ReefIdentifier", "LiveDate", "LiveDate_Qualifier", "LiveDate_MinEstDate", "LiveDate_MaxEstDate", "GISUniqueID", "SampleDate", "Year", "Month", "ManagedAreaName", "Region.x", "SurveyMethod", "HabitatClassification", "MinimumSizeMeasured_mm", "NumberMeasured_n", "QuadSize_m2", "MADup", "DataFileName", "ShellHeight_mm", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal", "SHIndex")] 
oysterraw_sh_nr <- oysterraw_sh_nr %>%
            dplyr::group_by(ProgramID, ProgramName, ProgramLocationID, QuadIdentifier, ReefIdentifier, 
                            LiveDate, LiveDate_Qualifier, LiveDate_MinEstDate, LiveDate_MaxEstDate, 
                            GISUniqueID, SampleDate, Year, Month, ManagedAreaName, Region.x, SurveyMethod, 
                            HabitatClassification, MinimumSizeMeasured_mm, NumberMeasured_n, QuadSize_m2, 
                            MADup, DataFileName, reefIDcrosswalk, Region.y, MA_plotlab, Subtidal) %>%
            tidyr::fill(ShellHeight_mm, SHIndex) %>%
            tidyr::fill(ShellHeight_mm, SHIndex, .direction = 'up') %>%
            dplyr::distinct()
oysterraw_sh_nr <- subset(oysterraw_sh_nr, !is.na(oysterraw_sh_nr$ShellHeight_mm) | !is.na(oysterraw_sh_nr$SHIndex))


#Create data table of density and counts
#oysterraw_den_nr <- oysterraw_nr[, c(2:6, 11:17, 19, 22:23, 25, 28:30, 32:35)]
oysterraw_den_nr <- oysterraw_nr[, c("ProgramID", "ProgramName", "ProgramLocationID", "QuadIdentifier", "ReefIdentifier", "GISUniqueID", "SampleDate", "Year", "Month", "ManagedAreaName", "Region.x", "SurveyMethod", "HabitatClassification", "QuadSize_m2", "MADup", "Density_m2", "Number_of_Oysters_Counted_Total_Count", "Number_of_Oysters_Counted_Live_Count", "Number_of_Oysters_Counted_Dead_Count", "DensIndex", "NTotIndex", "NLiveIndex", "NDeadIndex", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal")]
oysterraw_den_nr <- unique(oysterraw_den_nr)
oysterraw_den_nr <- oysterraw_den_nr %>% 
                     dplyr::group_by(ProgramID, ProgramName, ProgramLocationID, QuadIdentifier, 
                                     ReefIdentifier, GISUniqueID, SampleDate, Year, Month, ManagedAreaName,
                                     Region.x, SurveyMethod, HabitatClassification, QuadSize_m2, MADup, reefIDcrosswalk, 
                                     Region.y, MA_plotlab, Subtidal) %>%
                     tidyr::fill(Density_m2, Number_of_Oysters_Counted_Total_Count, 
                                 Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count,
                                 DensIndex, NTotIndex, NLiveIndex, NDeadIndex) %>%
                     tidyr::fill(Density_m2, Number_of_Oysters_Counted_Total_Count, 
                                 Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count, 
                                 DensIndex, NTotIndex, NLiveIndex, NDeadIndex, .direction = 'up') %>%
                     dplyr::distinct()



oysterraw_den_nr <- subset(oysterraw_den_nr, !is.na(oysterraw_den_nr$Density_m2) |
                             !is.na(oysterraw_den_nr$Number_of_Oysters_Counted_Total_Count) | 
                             !is.na(oysterraw_den_nr$Number_of_Oysters_Counted_Live_Count) | 
                             !is.na(oysterraw_den_nr$Number_of_Oysters_Counted_Dead_Count) |
                             !is.na(oysterraw_den_nr$DensIndex) | !is.na(oysterraw_den_nr$NTotIndex) |
                             !is.na(oysterraw_den_nr$NLiveIndex) | !is.na(oysterraw_den_nr$NDeadIndex))



#Create data table of percent live
#oysterraw_pct_nr <- oysterraw_nr[, c(2:6, 11:17, 18:19, 22:23, 26, 28:30, 32:35)]
oysterraw_pct_nr <- oysterraw_nr[, c("ProgramID", "ProgramName", "ProgramLocationID", "QuadIdentifier", "ReefIdentifier", "GISUniqueID", "SampleDate", "Year", "Month", "ManagedAreaName", "Region.x", "SurveyMethod", "PercentLiveMethod", "HabitatClassification", "QuadSize_m2", "MADup", "PercentLive_pct", "Number_of_Oysters_Counted_Total_Count", "Number_of_Oysters_Counted_Live_Count", "Number_of_Oysters_Counted_Dead_Count", "PctIndex", "NTotIndex", "NLiveIndex", "NDeadIndex", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal")]
oysterraw_pct_nr <- unique(oysterraw_pct_nr)
oysterraw_pct_nr <- oysterraw_pct_nr %>% 
                     dplyr::group_by(ProgramID, ProgramName, ProgramLocationID, QuadIdentifier, 
                                     ReefIdentifier, GISUniqueID, SampleDate, Year, Month, ManagedAreaName,
                                     Region.x, SurveyMethod, PercentLiveMethod, HabitatClassification, QuadSize_m2, MADup, 
                                     reefIDcrosswalk, Region.y, MA_plotlab, Subtidal) %>%
                     tidyr::fill(PercentLive_pct, Number_of_Oysters_Counted_Total_Count, 
                                 Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count, 
                                 PctIndex, NTotIndex, NLiveIndex, NDeadIndex) %>%
                     tidyr::fill(PercentLive_pct, Number_of_Oysters_Counted_Total_Count, 
                                 Number_of_Oysters_Counted_Live_Count, Number_of_Oysters_Counted_Dead_Count, 
                                 PctIndex, NTotIndex, NLiveIndex, NDeadIndex, .direction = 'up') %>%
                     dplyr::distinct()



oysterraw_pct_nr <- subset(oysterraw_pct_nr, !is.na(oysterraw_pct_nr$PercentLive_pct) |
                             !is.na(oysterraw_pct_nr$Number_of_Oysters_Counted_Total_Count) | 
                             !is.na(oysterraw_pct_nr$Number_of_Oysters_Counted_Live_Count) | 
                             !is.na(oysterraw_pct_nr$Number_of_Oysters_Counted_Dead_Count) |
                             !is.na(oysterraw_pct_nr$PctIndex) | !is.na(oysterraw_pct_nr$NTotIndex) |
                             !is.na(oysterraw_pct_nr$NLiveIndex) | !is.na(oysterraw_pct_nr$NDeadIndex))


```

***

## Sample locations by indicator

<br>

Oyster reef sample locations map clipped to those locations where shell height data were collected. Grey sample locations are those that did not match to one of the oyster reef polygons. Note that the sample locations are jittered so that indicators measured at the same location will still be visible.

<br>

```{r SampleLocationsByIndicator-NovtoMar-Map, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}

oysterraw_sh_nr <- readRDS(here::here("oysterraw_sh_nr.rds"))
reefcrosswalk_rcp_sh <- subset(reefcrosswalk_rcp, reefcrosswalk_rcp$ProgramLoc %in% unique(oysterraw_sh_nr$ProgramLocationID))
reefcrosswalk_rcp_sh$ProgramID <- as.factor(reefcrosswalk_rcp_sh$ProgramID)
reefcrosswalk_rcp_sh <- st_jitter(reefcrosswalk_rcp_sh, factor = 0.00001)

oysterraw_den_nona_nr <- readRDS(here::here("oysterraw_den_nona_nr.rds"))
reefcrosswalk_rcp_den <- subset(reefcrosswalk_rcp, reefcrosswalk_rcp$ProgramLoc %in% unique(oysterraw_den_nona_nr$ProgramLocationID))
reefcrosswalk_rcp_den$ProgramID <- as.factor(reefcrosswalk_rcp_den$ProgramID)
reefcrosswalk_rcp_den <- st_jitter(reefcrosswalk_rcp_den, factor = 0.00001)

oysterraw_pct_nona_nr <- readRDS(here::here("oysterraw_pct_nona_nr.rds"))
reefcrosswalk_rcp_pct <- subset(reefcrosswalk_rcp, reefcrosswalk_rcp$ProgramLoc %in% unique(oysterraw_pct_nona_nr$ProgramLocationID))
reefcrosswalk_rcp_pct$ProgramID <- as.factor(reefcrosswalk_rcp_pct$ProgramID)
reefcrosswalk_rcp_pct <- st_jitter(reefcrosswalk_rcp_pct, factor = 0.00001)

mapview(othernerrs, color = "dark grey", col.regions = "dark grey", alpha.regions = 0, layer.name = "Apalachicola NERR and Rookery Bay NERR") +
  mapview(GTMnew, color = "dark grey", col.regions = "dark grey", alpha.regions = 0, layer.name = "Guana Tolomato Matanzas NERR") +
  mapview(aps, color = "blue", col.regions = "blue", alpha.regions = 0, layer.name = "Florida Aquatic Preserves") +
  mapview(GTMRegions, alpha.regions = 0.15, layer.name = "GTM NERR Regions") +
  mapview(fwcoymap_m_rcp, col.regions = "sienna", layer.name = "Oyster reefs") +
  mapview(reefcrosswalk_rcp_sh, col.regions = "green3", layer.name = "Oyster size class samples") +
  mapview(reefcrosswalk_rcp_den, col.regions = "deepskyblue3", layer.name = "Oyster density samples") +
  mapview(reefcrosswalk_rcp_pct, col.regions = "orangered", layer.name = "Oyster percent live samples")

```

<br><br><br>

## Oyster size class

```{r Process-and-summarize-shell-height-data-nr, echo=TRUE, message = FALSE, warning = FALSE}

setDT(oysterraw_sh_nr)
oysterraw_sh_nr <- oysterraw_sh_nr %>% mutate(SampleDate = mdy_hms(SampleDate)) #convert Time to a timestamp
oysterraw_sh_nr[, LiveDate2 := ifelse(LiveDate %in% "", year(SampleDate), ifelse(grepl("/", LiveDate, fixed = 
             TRUE), year(mdy(LiveDate)), ifelse(grepl("-", LiveDate, fixed = TRUE), year(ymd(LiveDate)), 
             LiveDate)))] 
oysterraw_sh_nr[, LiveDate2 := as.numeric(LiveDate2)][, ('LiveDate2') := round(.SD, 0), .SDcols = 'LiveDate2']
oysterraw_sh_nr <- oysterraw_sh_nr[!is.na(LiveDate2)]
oysterraw_sh_nr[, LiveDate2 := strptime(LiveDate2, "%Y")]
#oysterraw_sh_nr[, MinimumSizeMeasured_mm := as.integer(MinimumSizeMeasured_mm)][ProgramID == 5035, MinimumSizeMeasured_mm := 20][ProgramID == 4016, NumberMeasured_n := 50]
oysterraw_sh_nr[, LiveDate2 := year(ymd(LiveDate2))]
oysterraw_sh_nr[LiveDate_Qualifier == "Exact (for live specimens only)", LiveDate_Qualifier := "Exact"]

#Remove unrealistically high shell heights from ID_5017
Fix5017 <- oysterraw_sh_nr[ProgramID == 5017, ][ShellHeight_mm < 165, ]
no5017 <- oysterraw_sh_nr[ProgramID != 5017, ]
oysterraw_sh_nr <- rbind(Fix5017, no5017)

#save a copy for later use
saveRDS(oysterraw_sh_nr, here::here('oysterraw_sh_nr.rds'))

#summarize shell height data
sh_all_sum_nr <- summarySE(oysterraw_sh_nr, measurevar = 'ShellHeight_mm', groupvars = c('ManagedAreaName', 
                        'LiveDate_Qualifier', 'LiveDate2'))
```

### Shell height data

<br>

[Click here to view the oyster shell height data file.](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7B4FC92EF1-1592-451C-8050-58AB4C9722B5%7D&file=OysterShellHeight_NovtoMar.xlsx&action=default&mobileredirect=true)

```{r Shell-height-data-nr, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_sh_nr, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:25), fontSize = '80%')

write.xlsx(oysterraw_sh_nr, file = here::here("DocsForSMEs/OysterShellHeight_NovtoMar.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br>

### Plot of shell height data availability

```{r Dot-plot-of-shell-height-data-availability-by-year-all-data-nr, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
SH_NovtoMar_DataAvailability <- ggplot(sh_all_sum_nr, aes(x = LiveDate2, y = ManagedAreaName, fill = LiveDate_Qualifier)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), shape = 21, color = "black", alpha = 0.5) +
  xlim(1950, 2020)
SH_NovtoMar_DataAvailability

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_DataAvailability_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_DataAvailability,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)

```

<br><br><br>

### Shell height summary tables {.tabset}

#### Shell height >25mm

```{r Subset-shell-heights-o25-and-create-summary-table-nr, echo=TRUE, message=FALSE, warning=FALSE}
#Subset to shell heights >25mm
sh_o25_nr <- oysterraw_sh_nr[ShellHeight_mm > 25, ]

sh_o25_nr[, nReefs := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'LiveDate_Qualifier', 'NumberMeasured_n', 'LiveDate2')]
sh_o25_nr[NumberMeasured_n != c(""), nReefsbyMAandLD_allLDQ_No20 := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'LiveDate2')]
sh_o25_nr[NumberMeasured_n != c(""), nProgsbyMAandLD_allLDQ_No20 := length(unique(ProgramID)), by = c('ManagedAreaName', 'LiveDate2')]
sh_o25_nr[NumberMeasured_n != c(""), ProgsbyMAandLD_allLDQ_No20 := list(list(unique(ProgramID))), by = c('ManagedAreaName', 'LiveDate2')]
sh_o25_nr[NumberMeasured_n != c(""), nProgsbyMA_allLD_allLDQ_No20 := length(unique(ProgramID)), by = c('ManagedAreaName')]
sh_o25_nr[NumberMeasured_n != c(""), ProgsbyMA_allLD_allLDQ_No20 := list(list(unique(ProgramID))), by = c('ManagedAreaName')]

#Create summary table showing number of reefs/programs of data included in sh_o25_nr
sh_o25_sum1_nr <- unique(sh_o25_nr[, .(ManagedAreaName, LiveDate2, nReefsbyMAandLD_allLDQ_No20, nProgsbyMAandLD_allLDQ_No20, nProgsbyMA_allLD_allLDQ_No20)], by = c('ManagedAreaName', 'LiveDate2', 'nReefsbyMAandLD_allLDQ_No20', 'nProgsbyMAandLD_allLDQ_No20', 'nProgsbyMA_allLD_allLDQ_No20'))
sh_o25_sum1_nr[, LiveDate := LiveDate2][, LiveDate2 := NULL]
listcols <- sh_o25_nr[, .SD[1], by = c('ManagedAreaName', 'LiveDate2')][, .(ProgsbyMAandLD_allLDQ_No20, ProgsbyMA_allLD_allLDQ_No20)]
sh_o25_sum1_nr <- cbind(sh_o25_sum1_nr, listcols)
setcolorder(sh_o25_sum1_nr, c('ManagedAreaName', 'nProgsbyMA_allLD_allLDQ_No20', 'ProgsbyMA_allLD_allLDQ_No20', 'LiveDate', 'nReefsbyMAandLD_allLDQ_No20', 'nProgsbyMAandLD_allLDQ_No20', 'ProgsbyMAandLD_allLDQ_No20'))
setorder(sh_o25_sum1_nr, ManagedAreaName, LiveDate)

#Create easily readable table in knitted document
#Better column names
sh_o25_sum1_renamed_nr <- setnames(sh_o25_sum1_nr, c('nProgsbyMA_allLD_allLDQ_No20', 'ProgsbyMA_allLD_allLDQ_No20', 'nReefsbyMAandLD_allLDQ_No20', 'nProgsbyMAandLD_allLDQ_No20', 'ProgsbyMAandLD_allLDQ_No20'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups_o25_nr <- c()
for(i in unique(sh_o25_sum1_nr$ManagedAreaName)){
  name <- paste0(i, ", Total Programs = ", sh_o25_sum1_nr[ManagedAreaName == i, 2][1], ": ", sh_o25_sum1_nr[ManagedAreaName == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
sh_o25_sum1_nr[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay, Total Programs = 2: c(5063, 4044)" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "Apalachicola Bay")$LiveDate), 
                      "Apalachicola NERR, Total Programs = 3: c(5063, 4044, 5075)" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "Apalachicola NERR")$LiveDate), 
                      "Boca Ciega Bay, Total Programs = 1: 4020" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "Boca Ciega Bay")$LiveDate), 
                      "Estero Bay, Total Programs = 2: c(4012, 4042)" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "Estero Bay")$LiveDate), 
                      "Guana River Marsh, Total Programs = 1: 4000" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "Guana River Marsh")$LiveDate),  
                      "Guana Tolomato Matanzas NERR, Total Programs = 1: 4000" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "Guana Tolomato Matanzas NERR")$LiveDate), 
                      "Pine Island Sound, Total Programs = 1: 4012" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "Pine Island Sound")$LiveDate),  
                      "Pinellas County, Total Programs = 1: 4020" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "Pinellas County")$LiveDate),  
                      "St. Martins Marsh, Total Programs = 1: 5074" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "St. Martins Marsh")$LiveDate),
                      "Yellow River Marsh, Total Programs = 1: 5073" = length(subset(sh_o25_sum1_nr, sh_o25_sum1_nr$ManagedAreaName == "Yellow River Marsh")$LiveDate)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")
```

<br><br><br>

#### Shell height >75mm

```{r Shell height >75mm summary table-nr, echo=TRUE, message = FALSE, warning = FALSE}
#Subset to only shell heights >75mm
sh_o75_nr <- oysterraw_sh_nr[ShellHeight_mm > 75, ]

sh_o75_nr[, nReefs := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'LiveDate_Qualifier', 'NumberMeasured_n', 'LiveDate2')]
sh_o75_nr[NumberMeasured_n != c("NA", "5", ""), nReefsbyMAandLD_allLDQ_No75 := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'LiveDate2')]
sh_o75_nr[NumberMeasured_n != c("NA", "5", ""), nProgsbyMAandLD_allLDQ_No75 := length(unique(ProgramID)), by = c('ManagedAreaName', 'LiveDate2')]
sh_o75_nr[NumberMeasured_n != c("NA", "5", ""), ProgsbyMAandLD_allLDQ_No75 := list(list(unique(ProgramID))), by = c('ManagedAreaName', 'LiveDate2')]
sh_o75_nr[NumberMeasured_n != c("NA", "5", ""), nProgsbyMA_allLD_allLDQ_No75 := length(unique(ProgramID)), by = c('ManagedAreaName')]
sh_o75_nr[NumberMeasured_n != c("NA", "5", ""), ProgsbyMA_allLD_allLDQ_No75 := list(list(unique(ProgramID))), by = c('ManagedAreaName')]

#Create summary table showing number of reefs/programs of data included in sh_o75_nr
sh_o75_sum1_nr <- unique(sh_o75_nr[, .(ManagedAreaName, LiveDate2, nReefsbyMAandLD_allLDQ_No75, nProgsbyMAandLD_allLDQ_No75, nProgsbyMA_allLD_allLDQ_No75)], by = c('ManagedAreaName', 'LiveDate2', 'nReefsbyMAandLD_allLDQ_No75', 'nProgsbyMAandLD_allLDQ_No75', 'nProgsbyMA_allLD_allLDQ_No75'))
sh_o75_sum1_nr[, LiveDate := LiveDate2][, LiveDate2 := NULL]
listcols <- sh_o75_nr[, .SD[1], by = c('ManagedAreaName', 'LiveDate2')][, .(ProgsbyMAandLD_allLDQ_No75, ProgsbyMA_allLD_allLDQ_No75)]
sh_o75_sum1_nr <- cbind(sh_o75_sum1_nr, listcols)
setcolorder(sh_o75_sum1_nr, c('ManagedAreaName', 'LiveDate', 'nReefsbyMAandLD_allLDQ_No75', 'nProgsbyMAandLD_allLDQ_No75', 'ProgsbyMAandLD_allLDQ_No75', 'nProgsbyMA_allLD_allLDQ_No75', 'ProgsbyMA_allLD_allLDQ_No75'))
setorder(sh_o75_sum1_nr, ManagedAreaName, LiveDate)

#Create easily readable table in knitted document
#Better column names
sh_o75_sum1_renamed <- setnames(sh_o75_sum1_nr, c('nProgsbyMA_allLD_allLDQ_No75', 'ProgsbyMA_allLD_allLDQ_No75', 'nReefsbyMAandLD_allLDQ_No75', 'nProgsbyMAandLD_allLDQ_No75', 'ProgsbyMAandLD_allLDQ_No75'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups <- c()
for(i in unique(sh_o75_sum1_nr$ManagedAreaName)){
  name <- paste0(i, ", Total Programs = ", sh_o75_sum1_nr[ManagedAreaName == i, 2][1], ": ", sh_o75_sum1_nr[ManagedAreaName == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
sh_o75_sum1_nr[, 2:5] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay, Total Programs = 2: c(5063, 4044)" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "Apalachicola Bay")$LiveDate), 
                      "Apalachicola NERR, Total Programs = 2: c(5063, 4044)" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "Apalachicola NERR")$LiveDate), 
                      "Boca Ciega Bay, Total Programs = 1: 4020" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "Boca Ciega Bay")$LiveDate), 
                      "Estero Bay, Total Programs = 2: c(4012, 4042)" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "Estero Bay")$LiveDate), 
                      "Guana River Marsh, Total Programs = 1: 4000" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "Guana River Marsh")$LiveDate),  
                      "Guana Tolomato Matanzas NERR, Total Programs = 1: 4000" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "Guana Tolomato Matanzas NERR")$LiveDate), 
                      "Pine Island Sound, Total Programs = 1: 4012" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "Pine Island Sound")$LiveDate),  
                      "Pinellas County, Total Programs = 1: 4020" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "Pinellas County")$LiveDate),  
                      "St. Martins Marsh, Total Programs = 1: 5074" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "St. Martins Marsh")$LiveDate), 
                      "Yellow River Marsh, Total Programs = 1: 5073" = length(subset(sh_o75_sum1_nr, sh_o75_sum1_nr$ManagedAreaName == "Yellow River Marsh")$LiveDate)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")

```


<br><br><br>  

### Histograms by reef and year {.tabset .tabset-fade}

#### Shell height >25mm {.tabset .tabset-fade .tabset-pills}

<br>

All histograms have 5mm bins.

<br>

##### Apalachicola Bay

```{r Histograms-ApalachicolaBay-o25-nr, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_AB_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "Apalachicola Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_AB_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_AB_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_AB_o25,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)

```

<br><br><br>  

##### Apalachicola NERR

```{r Histograms-ApalachicolaNERR-o25-nr, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_ANERR_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "Apalachicola NERR"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_ANERR_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_ANERR_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_ANERR_o25,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Boca Ciega Bay

```{r Histograms-BocaCiegaBay-o25-nr, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_BCB_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "Boca Ciega Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_BCB_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_BCB_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_BCB_o25,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Estero Bay

```{r Histograms-EsteroBay-o25-nr, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_EB_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "Estero Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_EB_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_EB_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_EB_o25,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Guana River Marsh

```{r Histograms-GuanaRiverMarsh-o25-nr, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_GRM_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "Guana River Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_GRM_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_GRM_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_GRM_o25,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Guana Tolomato Matanzas NERR

```{r Histograms-GuanaTolomatoMatanzasNERR-o25-nr, echo=TRUE, fig.height=100, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_GTMNERR_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "Guana Tolomato Matanzas NERR"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_GTMNERR_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_GTMNERR_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_GTMNERR_o25,
       width = 10,
       height = 100,
       units = "in",
       dpi = 300,
       limitsize = FALSE)
```

<br><br><br> 

##### Pine Island Sound

```{r Histograms-PineIslandSound-o25-nr, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_PIS_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "Pine Island Sound"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_PIS_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_PIS_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_PIS_o25,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### Pinellas County

```{r Histograms-PinellasCounty-o25-nr, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_PCo_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "Pinellas County"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_PCo_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_PCo_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_PCo_o25,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br>  

##### St. Martins Marsh

```{r Histograms-StMartinsMarsh-o25-nr, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_SMM_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "St. Martins Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_SMM_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_SMM_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_SMM_o25,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Yellow River Marsh

```{r Histograms-YellowRiverMarsh-o25-nr, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_YRM_o25 <- ggplot(subset(sh_o25_nr, sh_o25_nr$ManagedAreaName == "Yellow River Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_YRM_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_YRM_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_YRM_o25,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br> 


#### Shell height >75mm {.tabset .tabset-fade .tabset-pills}

<br>

All histograms have 5mm bins.

<br>

##### Apalachicola NERR
```{r Histograms-ApalachicolaNERR-o75-nr, echo=TRUE, fig.height=40, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_ANERR_o75 <- ggplot(subset(sh_o75_nr, sh_o75_nr$ManagedAreaName == "Apalachicola NERR"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_ANERR_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_ANERR_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_ANERR_o75,
       width = 10,
       height = 40,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Boca Ciega Bay
```{r Histograms-BocaCiegaBay-o75-nr, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_BCB_o75 <- ggplot(subset(sh_o75_nr, sh_o75_nr$ManagedAreaName == "Boca Ciega Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_BCB_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_BCB_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_BCB_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Estero Bay
```{r Histograms-EsteroBay-o75-nr, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_EB_o75 <- ggplot(subset(sh_o75_nr, sh_o75_nr$ManagedAreaName == "Estero Bay"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_EB_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_EB_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_EB_o75,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Guana River Marsh
```{r Histograms-GuanaRiverMarsh-o75-nr, echo=TRUE, fig.height=50, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_GRM_o75 <- ggplot(subset(sh_o75_nr, sh_o75_nr$ManagedAreaName == "Guana River Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_GRM_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_GRM_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_GRM_o75,
       width = 10,
       height = 49,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Guana Tolomato Matanzas NERR
```{r Histograms-GuanaTolomatoMatanzasNERR-o75-nr, echo=TRUE, fig.height=80, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_GTMNERR_o75 <- ggplot(subset(sh_o75_nr, sh_o75_nr$ManagedAreaName == "Guana Tolomato Matanzas NERR"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_GTMNERR_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_GTMNERR_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_GTMNERR_o75,
       width = 10,
       height = 80,
       units = "in",
       dpi = 300,
       limitsize = FALSE)
```

<br><br><br>

##### Pine Island Sound
```{r Histograms-PineIslandSound-o75-nr, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_PIS_o75 <- ggplot(subset(sh_o75_nr, sh_o75_nr$ManagedAreaName == "Pine Island Sound"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_PIS_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_PIS_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_PIS_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Pinellas County
```{r Histograms-PinellasCounty-o75-nr, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_PCo_o75 <- ggplot(subset(sh_o75_nr, sh_o75_nr$ManagedAreaName == "Pinellas County"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_PCo_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_PCo_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_PCo_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### St. Martins Marsh
```{r Histograms-StMartinsMarsh-o75-nr, echo=TRUE, fig.height=10, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_SMM_o75 <- ggplot(subset(sh_o75_nr, sh_o75_nr$ManagedAreaName == "St. Martins Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_SMM_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_SMM_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_SMM_o75,
       width = 10,
       height = 10,
       units = "in",
       dpi = 300)
```

<br><br><br> 

##### Yellow River Marsh
```{r Histograms-YellowRiverMarsh-o75-nr, echo=TRUE, fig.height=5, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
SH_NovtoMar_Hist_YRM_o75 <- ggplot(subset(sh_o75_nr, sh_o75_nr$ManagedAreaName == "Yellow River Marsh"), aes(x = ShellHeight_mm)) +
  theme_bw() +
  geom_histogram(fill = 'grey', color = 'black', binwidth = 5) +
  facet_grid(reefIDcrosswalk ~ LiveDate2, scales = 'free_y')
SH_NovtoMar_Hist_YRM_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_Hist_YRM_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_Hist_YRM_o75,
       width = 10,
       height = 5,
       units = "in",
       dpi = 300)
```

<br><br><br>


### Shell height plots by year {.tabset .tabset-fade}

#### Point plots {.tabset .tabset-fade .tabset-pills}

##### All shell heights

```{r AvgSHbyYRall-plot-nr, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
#Average shell height by year and managed area
avg_sh_all_nr <- oysterraw_sh_nr[, MeanSH := mean(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, sdSH := sd(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, semSH := sd(ShellHeight_mm)/sqrt(length(ShellHeight_mm)), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')]

avg_sh_all_nr[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
SH_NovtoMar_avg_all <- ggplot(avg_sh_all_nr, aes(x = LiveDate2, y = MeanSH, color = as.factor(ProgramID))) +
  geom_point() +
  facet_wrap(~MA_plotlab, ncol = 3, scales = "free") +
  #xlim(1950, 2020)
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2012, 2021)) +
  scale_y_continuous(limits = c(0, 65)) +
  #coord_cartesian(xlim = c(2007, 2020)) +
  labs(color = "Program ID")
SH_NovtoMar_avg_all

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_avg_all_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_avg_all,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Shell height >25mm

```{r AvgSHbyYRo25-plot-nr, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
#Average shell height by year and managed area (>25mm shell height only)
avg_sh_o25_nr <- sh_o25_nr[, MeanSH := mean(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, sdSH := sd(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, semSH := sd(ShellHeight_mm)/sqrt(length(ShellHeight_mm)), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')]

avg_sh_o25_nr[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
SH_NovtoMar_avg_o25 <- ggplot(avg_sh_o25_nr, aes(x = LiveDate2, y = MeanSH, color = as.factor(ProgramID))) +
  geom_point() +
  facet_wrap(~MA_plotlab, ncol = 3, scales = "free") +
  #xlim(1950, 2020)
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2012, 2021)) +
  scale_y_continuous(limits = c(25, 70)) +
  #coord_cartesian(xlim = c(2007, 2020)) +
  labs(color = "Program ID")
SH_NovtoMar_avg_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_avg_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_avg_o25,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Shell height >75mm

```{r AvgSHbyYRo75-plot-nr, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
#Average shell height by year and managed area (>75mm shell height only)
avg_sh_o75_nr <- sh_o75_nr[, MeanSH := mean(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, sdSH := sd(ShellHeight_mm), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')][, semSH := sd(ShellHeight_mm)/sqrt(length(ShellHeight_mm)), by = c('LiveDate2', 'ManagedAreaName', 'HabitatClassification')]

avg_sh_o75_nr[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
SH_NovtoMar_avg_o75 <- ggplot(avg_sh_o75_nr, aes(x = LiveDate2, y = MeanSH, color = as.factor(ProgramID))) +
  theme_bw() +
  geom_point() +
  facet_wrap(~MA_plotlab, ncol = 3, scales = "free") +
  #xlim(1950, 2020)
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2012, 2021)) +
  scale_y_continuous(limits = c(75, 95)) +
  #coord_cartesian(xlim = c(2007, 2020)) +
  labs(color = "Program ID")
SH_NovtoMar_avg_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_avg_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_avg_o75,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

#### Boxplots {.tabset .tabset-fade .tabset-pills}

##### Shell height >25mm

```{r SHbyYRo25-boxplots-nr, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
sh_o25_nr[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
SH_NovtoMar_byYR_o25 <- ggplot(sh_o25_nr, aes(LiveDate2, ShellHeight_mm, group = LiveDate2)) + #color = as.factor(ProgramID))) +
  geom_boxplot() +
  facet_wrap(~MA_plotlab, ncol = 3, scales = "free") +
#  annotate(geom = 'text', x = 1960, y = 100, label = unique(sh_o25_nr$ProgramID), vjust = "inward", hjust = "inward") +
  #xlim(1950, 2020) #+
#  theme(aspect.ratio = 0.05)
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2012, 2021)) #+
  scale_y_continuous(limits = c(0, 175))
  #coord_cartesian(xlim = c(2007, 2020)) +
  #labs(color = "Program ID")
SH_NovtoMar_byYR_o25

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_byYR_o25_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_byYR_o25,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

##### Shell height >75mm

```{r SHbyYRo75-boxplots-nr, echo=TRUE, message = FALSE, warning = FALSE, fig.height=20, fig.width=10, out.width="100%"}
SH_NovtoMar_byYR_o75 <- ggplot(sh_o75_nr, aes(LiveDate2, ShellHeight_mm, group = LiveDate2)) + #color = as.factor(ProgramID))) +
  theme_bw() +
  geom_boxplot() +
  facet_wrap(~MA_plotlab, ncol = 2, scales = "free") +
  #xlim(1950, 2020)
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2012, 2021))
  #scale_y_continuous(limits = c(75, 175)) #+
  #coord_cartesian(xlim = c(2007, 2020)) +
  #labs(color = "Program ID")
SH_NovtoMar_byYR_o75

ggsave(here::here(paste0("OA_plots/SH_NovtoMar_byYR_o75_", Sys.Date(), ".jpeg")),
       SH_NovtoMar_byYR_o75,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

<br><br><br>

***

## Live density

```{r DensitySetup-nr, echo=TRUE, message=FALSE, warning=FALSE}
setDT(oysterraw_den_nr)
oysterraw_den_nr <- oysterraw_den_nr %>% mutate(SampleDate = mdy_hms(SampleDate))
oysterraw_den_nr[, Month := month(SampleDate)]
oysterraw_den_nr[, YrMo := paste0(Year, "-", Month)]

#Fix QuadID and ReefID columns for 2003 data in program 4014
Reefs_4014_2003 <- c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13')
Quads_4014_2003 <- c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '13', '14')
Fix4014 <- oysterraw_den_nr[ProgramID == 4014, ][Year == 2003, QuadIdentifier := Quads_4014_2003][Year == 2003, ReefIdentifier := Reefs_4014_2003][Year == 2003, Density_m2 := Number_of_Oysters_Counted_Live_Count * 4]
no4014 <- subset(oysterraw_den_nr, oysterraw_den_nr$ProgramID != 4014)
oysterraw_den_nr <- rbind(Fix4014, no4014)

#Fix density for program 972
oysterraw_den_nr <- oysterraw_den_nr[ProgramID == 972, Density_m2 := (Number_of_Oysters_Counted_Live_Count/6) * 4]

#Fix density for program 4012
Fix4012 <- oysterraw_den_nr[ProgramID == 4012, ][is.na(Density_m2), Density_m2 := Number_of_Oysters_Counted_Live_Count / as.numeric(QuadSize_m2)]
Fix4012 <- Fix4012[QuadIdentifier %like% "_Ref", HabitatClassification := "Natural"]
Fix4012 <- Fix4012[QuadIdentifier %like% "_C", HabitatClassification := "Natural"]
no4012 <- subset(oysterraw_den_nr, oysterraw_den_nr$ProgramID != 4012)
oysterraw_den_nr <- rbind(Fix4012, no4012)

#Fix density for program 4042
Fix4042 <- oysterraw_den_nr[ProgramID == 4042, ][is.na(Density_m2), Density_m2 := Number_of_Oysters_Counted_Live_Count / as.numeric(QuadSize_m2)]
no4042 <- subset(oysterraw_den_nr, oysterraw_den_nr$ProgramID != 4042)
oysterraw_den_nr <- rbind(Fix4042, no4042)

#Fix density for program 4016
Fix4016 <- oysterraw_den_nr[ProgramID == 4016, ][is.na(Density_m2), Density_m2 := Number_of_Oysters_Counted_Live_Count / as.numeric(QuadSize_m2)]
no4016 <- subset(oysterraw_den_nr, oysterraw_den_nr$ProgramID != 4016)
oysterraw_den_nr <- rbind(Fix4016, no4016)
```

```{r echo=TRUE}
#Summarize density data by managed area
oysterraw_den_nona_nr <- subset(oysterraw_den_nr, !is.na(oysterraw_den_nr$Density_m2))
den_all_sum_nr <- summarySE(oysterraw_den_nona_nr, measurevar = 'Density_m2', groupvars = c('ManagedAreaName', 'Year'))

#Summarize density data by managed area (mean density 25mm <= x < 75)
oysterraw_den_r_seed_nr <- readRDS(here::here('oysterraw_den_r_seed_nr.rds'))
den_25to75_sum_nr <- summarySE(oysterraw_den_r_seed_nr, measurevar = 'meanDen', groupvars = c('ManagedAreaName', 'LiveDate2'))
colnames(den_25to75_sum_nr)[2] <- "Year"

#Summarize density data by managed area (mean density >= 75)
oysterraw_den_r_market_nr <- readRDS(here::here('oysterraw_den_r_market_nr.rds'))
den_o75_sum_nr <- summarySE(oysterraw_den_r_market_nr, measurevar = 'meanDen', groupvars = c('ManagedAreaName', 'LiveDate2'))
colnames(den_o75_sum_nr)[2] <- "Year"

```

### Density data {.tabset .tabset-fade}

#### Raw density values

<br>

[Click here to view the oyster density data file.](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7BA7147ADB-E66C-44C0-A159-71047590D45C%7D&file=OysterDensity_NovtoMar.xlsx&action=default&mobileredirect=true)

```{r Density-data-nr, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_den_nr, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:19), fontSize = '80%')

write.xlsx(oysterraw_den_nr, file = here::here("DocsForSMEs/OysterDensity_NovtoMar.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br>

#### Only 25-75mm shell height

<br>

This data file includes estimated density values of specimens between 25mm and 75mm shell height (i.e., seed size). The estimates were calculated by drawing random samples (without replacement) of n=20 from all samples of n>20 (samples were identified as a combination of the reefIDcrosswalk, QuadIdentifier, Year, and Month variables), then subsetting the random samples to just the specimens between 25 and 75mm in shell height (25mm <= x < 75mm) and storing the number of shells in the subsets as counts. This procedure was repeated 1000 times and then the 1000 count values for each sample were averaged.

[Click here to view the oyster density data file (25-75mm shell height).](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7B37944C48-82B1-4DC4-99DE-DEEBEF8721D8%7D&file=OysterDensity_NovtoMar_25to75mm.xlsx&action=default&mobileredirect=true)

```{r Density-data-25-75mm-nr, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_den_r_seed_nr, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:29), fontSize = '80%')

write.xlsx(oysterraw_den_r_seed_nr, file = here::here("DocsForSMEs/OysterDensity_NovtoMar_25to75mm.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br>

#### Only >75mm shell height

<br>

This data file includes estimated density values of specimens >75mm shell height (i.e., market size). The estimates were calculated by drawing random samples (without replacement) of n=20 from all samples of n>20 (samples were identified as a combination of the reefIDcrosswalk, QuadIdentifier, Year, and Month variables), then subsetting the random samples to just the specimens >75mm in shell height (x >= 75mm) and storing the number of shells in the subsets as counts. This procedure was repeated 1000 times and then the 1000 count values for each sample were averaged.

[Click here to view the oyster density data file (>75mm shell height).](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7BB1ADC725-E391-4965-AE2A-3F8BF536F954%7D&file=OysterDensity_NovtoMar_o75mm.xlsx&action=default&mobileredirect=true)

```{r Density-data-o75mm-nr, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_den_r_market_nr, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:29), fontSize = '80%')

write.xlsx(oysterraw_den_r_market_nr, file = here::here("DocsForSMEs/OysterDensity_NovtoMar_o75mm.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br>


### Plot of density data availability {.tabset .tabset-fade}

#### Raw density values

```{r DenDataAvailabilityPlot-raw-nr, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
Den_NovtoMar_DataAvailability_raw <- ggplot(den_all_sum_nr, aes(x = Year, y = ManagedAreaName)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), shape = 21, fill = "navy blue", color = "black", alpha = 0.5)
Den_NovtoMar_DataAvailability_raw

ggsave(here::here(paste0("OA_plots/Den_NovtoMar_DataAvailability_raw_", Sys.Date(), ".jpeg")),
       Den_NovtoMar_DataAvailability_raw,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)
```

<br><br><br>

#### Only 25-75mm shell height (1950-2020)

```{r DenDataAvailabilityPlot-25-75mm-nr, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
Den_NovtoMar_DataAvailability_25to75 <- ggplot(den_25to75_sum_nr, aes(x = Year, y = ManagedAreaName)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), shape = 21, fill = "navy blue", color = "black", alpha = 0.5) +
  xlim(1950, 2020)
Den_NovtoMar_DataAvailability_25to75

ggsave(here::here(paste0("OA_plots/Den_NovtoMar_DataAvailability_25to75_", Sys.Date(), ".jpeg")),
       Den_NovtoMar_DataAvailability_25to75,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)
```

<br><br><br>

#### Only >75mm shell height (1950-2020)

```{r DenDataAvailabilityPlot-o75mm-nr, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
Den_NovtoMar_DataAvailability_o75 <- ggplot(den_o75_sum_nr, aes(x = Year, y = ManagedAreaName)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), shape = 21, fill = "navy blue", color = "black", alpha = 0.5) +
  xlim(1950, 2020)
Den_NovtoMar_DataAvailability_o75

ggsave(here::here(paste0("OA_plots/Den_NovtoMar_DataAvailability_o75_", Sys.Date(), ".jpeg")),
       Den_NovtoMar_DataAvailability_o75,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)
```

<br><br><br>

### Density summary table {.tabset .tabset-fade}

#### Raw density values

```{r DenSummaryTable-raw-nr, echo=TRUE, message=FALSE, warning=FALSE}
#Create summary table showing number of reefs/programs of data included in oysterraw_den_nr
oysterraw_den_nona_nr[, nReefsbyMAandYr := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'Year')]
oysterraw_den_nona_nr[, nProgsbyMAandYr := length(unique(ProgramID)), by = c('ManagedAreaName', 'Year')]
oysterraw_den_nona_nr[, ProgsbyMAandYr := list(list(unique(ProgramID))), by = c('ManagedAreaName', 'Year')]
oysterraw_den_nona_nr[, nProgsbyMA := length(unique(ProgramID)), by = 'ManagedAreaName']
oysterraw_den_nona_nr[, ProgsbyMA := list(list(unique(ProgramID))), by = 'ManagedAreaName']

den_sum1_nr <- unique(oysterraw_den_nona_nr[, .(ManagedAreaName, Year, nReefsbyMAandYr, nProgsbyMAandYr, nProgsbyMA)], by = c('ManagedAreaName', 'Year', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'nProgsbyMA'))
listcols <- oysterraw_den_nona_nr[, .SD[1], by = c('ManagedAreaName', 'Year')][, .(ProgsbyMAandYr, ProgsbyMA)]
den_sum1_nr <- cbind(den_sum1_nr, listcols)
setcolorder(den_sum1_nr, c('ManagedAreaName', 'nProgsbyMA', 'ProgsbyMA', 'Year', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'))
setorder(den_sum1_nr, ManagedAreaName, Year)

#Create easily readable table in knitted document
#Better column names
den_sum1_renamed_nr <- setnames(den_sum1_nr, c('nProgsbyMA', 'ProgsbyMA', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups <- c()
for(i in unique(den_sum1_nr$ManagedAreaName)){
  name <- paste0(i, ", Total Programs = ", den_sum1_nr[ManagedAreaName == i, 2][1], ": ", den_sum1_nr[ManagedAreaName == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
den_sum1_nr[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay, Total Programs = 3: c(4044, 5063, 5073)" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Apalachicola Bay")$Year), 
                      "Apalachicola NERR, Total Programs = 4: c(4044, 5063, 5073, 5075)" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Apalachicola NERR")$Year), 
                      "Boca Ciega Bay, Total Programs = 1: 4020" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Boca Ciega Bay")$Year), 
                      "Estero Bay, Total Programs = 2: c(4012, 4042)" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Estero Bay")$Year), 
                      "Guana River Marsh, Total Programs = 1: 4000" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Guana River Marsh")$Year),  
                      "Guana Tolomato Matanzas NERR, Total Programs = 1: 4000" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Guana Tolomato Matanzas NERR")$Year), 
                      "Lemon Bay, Total Programs = 1: 972" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Lemon Bay")$Year), 
                      "Pine Island Sound, Total Programs = 1: 4012" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Pine Island Sound")$Year),  
                      "Pinellas County, Total Programs = 1: 4020" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Pinellas County")$Year),  
                      "St. Martins Marsh, Total Programs = 1: 5074" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "St. Martins Marsh")$Year), 
                      "Yellow River Marsh, Total Programs = 1: 5073" = length(subset(den_sum1_nr, den_sum1_nr$ManagedAreaName == "Yellow River Marsh")$Year)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")
```

<br><br><br>

#### Only 25-75mm shell height

```{r DenSummaryTable-25-75mm-nr, echo=TRUE, message=FALSE, warning=FALSE}
#Create summary table showing number of reefs/programs of data included in oysterraw_den_r_seed_nr
oysterraw_den_r_seed_nr[, nReefsbyMAandYr := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'LiveDate2')]
oysterraw_den_r_seed_nr[, nProgsbyMAandYr := length(unique(ProgramID)), by = c('ManagedAreaName', 'LiveDate2')]
oysterraw_den_r_seed_nr[, ProgsbyMAandYr := list(list(unique(ProgramID))), by = c('ManagedAreaName', 'LiveDate2')]
oysterraw_den_r_seed_nr[, nProgsbyMA := length(unique(ProgramID)), by = 'ManagedAreaName']
oysterraw_den_r_seed_nr[, ProgsbyMA := list(list(unique(ProgramID))), by = 'ManagedAreaName']

den_sum1_seed_nr <- unique(oysterraw_den_r_seed_nr[, .(ManagedAreaName, LiveDate2, nReefsbyMAandYr, nProgsbyMAandYr, nProgsbyMA)], by = c('ManagedAreaName', 'LiveDate2', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'nProgsbyMA'))
listcols <- oysterraw_den_r_seed_nr[, .SD[1], by = c('ManagedAreaName', 'LiveDate2')][, .(ProgsbyMAandYr, ProgsbyMA)]
den_sum1_seed_nr <- cbind(den_sum1_seed_nr, listcols)
setcolorder(den_sum1_seed_nr, c('ManagedAreaName', 'nProgsbyMA', 'ProgsbyMA', 'LiveDate2', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'))
setorder(den_sum1_seed_nr, ManagedAreaName, LiveDate2)

#Create easily readable table in knitted document
#Better column names
den_sum1_seed_renamed_nr <- setnames(den_sum1_seed_nr, c('nProgsbyMA', 'ProgsbyMA', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups <- c()
for(i in unique(den_sum1_seed_nr$ManagedAreaName)){
  name <- paste0(i, ", Total Programs = ", den_sum1_seed_nr[ManagedAreaName == i, 2][1], ": ", den_sum1_seed_nr[ManagedAreaName == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
den_sum1_seed_nr[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay, Total Programs = 2: c(4044, 5063)" = length(subset(den_sum1_seed_nr, den_sum1_seed_nr$ManagedAreaName == "Apalachicola Bay")$LiveDate2), 
                      "Apalachicola NERR, Total Programs = 3: c(4044, 5063, 5075)" = length(subset(den_sum1_seed_nr, den_sum1_seed_nr$ManagedAreaName == "Apalachicola NERR")$LiveDate2), 
                      "Boca Ciega Bay, Total Programs = 1: 4020" = length(subset(den_sum1_seed_nr, den_sum1_seed_nr$ManagedAreaName == "Boca Ciega Bay")$LiveDate2),
                      "Estero Bay, Total Programs = 2: c(4012, 4042)" = length(subset(den_sum1_seed_nr, den_sum1_seed_nr$ManagedAreaName == "Estero Bay")$LiveDate2), 
                      "Guana River Marsh, Total Programs = 1: 4000" = length(subset(den_sum1_seed_nr, den_sum1_seed_nr$ManagedAreaName == "Guana River Marsh")$LiveDate2),  
                      "Guana Tolomato Matanzas NERR, Total Programs = 1: 4000" = length(subset(den_sum1_seed_nr, den_sum1_seed_nr$ManagedAreaName == "Guana Tolomato Matanzas NERR")$LiveDate2), 
                      "Pine Island Sound, Total Programs = 1: 4012" = length(subset(den_sum1_seed_nr, den_sum1_seed_nr$ManagedAreaName == "Pine Island Sound")$LiveDate2),  
                      "Pinellas County, Total Programs = 1: 4020" = length(subset(den_sum1_seed_nr, den_sum1_seed_nr$ManagedAreaName == "Pinellas County")$LiveDate2),  
                      "St. Martins Marsh, Total Programs = 1: 5074" = length(subset(den_sum1_seed_nr, den_sum1_seed_nr$ManagedAreaName == "St. Martins Marsh")$LiveDate2)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")
```

<br><br><br>

#### Only >75mm shell height

```{r DenSummaryTable-o75mm-nr, echo=TRUE, message=FALSE, warning=FALSE}
#Create summary table showing number of reefs/programs of data included in oysterraw_den_r_market_nr
oysterraw_den_r_market_nr[, nReefsbyMAandYr := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'LiveDate2')]
oysterraw_den_r_market_nr[, nProgsbyMAandYr := length(unique(ProgramID)), by = c('ManagedAreaName', 'LiveDate2')]
oysterraw_den_r_market_nr[, ProgsbyMAandYr := list(list(unique(ProgramID))), by = c('ManagedAreaName', 'LiveDate2')]
oysterraw_den_r_market_nr[, nProgsbyMA := length(unique(ProgramID)), by = 'ManagedAreaName']
oysterraw_den_r_market_nr[, ProgsbyMA := list(list(unique(ProgramID))), by = 'ManagedAreaName']

den_sum1_market_nr <- unique(oysterraw_den_r_market_nr[, .(ManagedAreaName, LiveDate2, nReefsbyMAandYr, nProgsbyMAandYr, nProgsbyMA)], by = c('ManagedAreaName', 'LiveDate2', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'nProgsbyMA'))
listcols <- oysterraw_den_r_market_nr[, .SD[1], by = c('ManagedAreaName', 'LiveDate2')][, .(ProgsbyMAandYr, ProgsbyMA)]
den_sum1_market_nr <- cbind(den_sum1_market_nr, listcols)
setcolorder(den_sum1_market_nr, c('ManagedAreaName', 'nProgsbyMA', 'ProgsbyMA', 'LiveDate2', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'))
setorder(den_sum1_market_nr, ManagedAreaName, LiveDate2)

#Create easily readable table in knitted document
#Better column names
den_sum1_market_renamed_nr <- setnames(den_sum1_market_nr, c('nProgsbyMA', 'ProgsbyMA', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups <- c()
for(i in unique(den_sum1_market_nr$ManagedAreaName)){
  name <- paste0(i, ", Total Programs = ", den_sum1_market_nr[ManagedAreaName == i, 2][1], ": ", den_sum1_market_nr[ManagedAreaName == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
den_sum1_market_nr[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay, Total Programs = 2: c(4044, 5063)" = length(subset(den_sum1_market_nr, den_sum1_market_nr$ManagedAreaName == "Apalachicola Bay")$LiveDate2), 
                      "Apalachicola NERR, Total Programs = 3: c(4044, 5063, 5075)" = length(subset(den_sum1_market_nr, den_sum1_market_nr$ManagedAreaName == "Apalachicola NERR")$LiveDate2), 
                      "Boca Ciega Bay, Total Programs = 1: 4020" = length(subset(den_sum1_market_nr, den_sum1_market_nr$ManagedAreaName == "Boca Ciega Bay")$LiveDate2),
                      "Estero Bay, Total Programs = 2: c(4012, 4042)" = length(subset(den_sum1_market_nr, den_sum1_market_nr$ManagedAreaName == "Estero Bay")$LiveDate2), 
                      "Guana River Marsh, Total Programs = 1: 4000" = length(subset(den_sum1_market_nr, den_sum1_market_nr$ManagedAreaName == "Guana River Marsh")$LiveDate2),  
                      "Guana Tolomato Matanzas NERR, Total Programs = 1: 4000" = length(subset(den_sum1_market_nr, den_sum1_market_nr$ManagedAreaName == "Guana Tolomato Matanzas NERR")$LiveDate2), 
                      "Pine Island Sound, Total Programs = 1: 4012" = length(subset(den_sum1_market_nr, den_sum1_market_nr$ManagedAreaName == "Pine Island Sound")$LiveDate2),  
                      "Pinellas County, Total Programs = 1: 4020" = length(subset(den_sum1_market_nr, den_sum1_market_nr$ManagedAreaName == "Pinellas County")$LiveDate2),  
                      "St. Martins Marsh, Total Programs = 1: 5074" = length(subset(den_sum1_market_nr, den_sum1_market_nr$ManagedAreaName == "St. Martins Marsh")$LiveDate2)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")
```

<br><br><br>

### Density box plots {.tabset .tabset-fade}

#### Raw density values

```{r boxplots-den-raw-nr, echo=TRUE, fig.height=20, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
#Box plots of density by year, by managed area
#oysterraw_den_nona_nr[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
oysterraw_den_nona_nr[, Yr_HC := paste0(Year, "_", HabitatClassification)]

Den_NovtoMar_BoxplotByYr_raw <- ggplot(oysterraw_den_nona_nr, aes(x = as.integer(Year), y = Density_m2, group = Yr_HC, fill = HabitatClassification)) +
  geom_boxplot() + #color = 'black', fill = 'light blue'
  facet_wrap(~ ManagedAreaName, ncol = 3, scales = 'free') +
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2006, 2021)) +
  #scale_y_continuous(limits = c(75, 175)) #+
  #coord_cartesian(xlim = c(2007, 2020)) +
  labs(fill = "Habitat Classification")
Den_NovtoMar_BoxplotByYr_raw

ggsave(here::here(paste0("OA_plots/Den_NovtoMar_BoxplotByYr_raw_", Sys.Date(), ".jpeg")),
       Den_NovtoMar_BoxplotByYr_raw,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

```{r AvgDenLive-setup-raw-nr, message=FALSE, warning=FALSE, include=FALSE}
#Density, all and by reef
den_avg_all_nr <- oysterraw_den_nona_nr[, MeanDen := mean(Density_m2), by = c('ManagedAreaName', 'Year')][, sdDen := sd(Density_m2), by = c('Year', 'ManagedAreaName')][, semDen := sd(Density_m2)/sqrt(length(Density_m2)), by = c('Year', 'ManagedAreaName')][, nYears := length(unique(Year)), by = c('ManagedAreaName')][, MeanReefDen := mean(Density_m2), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefDen := sd(Density_m2), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefDen := sd(Density_m2)/sqrt(length(Density_m2)), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef := length(unique(Year)), by = c('ManagedAreaName', 'reefIDcrosswalk')]
#den_avg_reef_nr <- unique(den_avg_all_nr[, c(1:2, 8, 10, 12:15, 20:23, 29:32)])
den_avg_reef_nr <- unique(den_avg_all_nr[, c("ProgramID", "ProgramName", "Year", "ManagedAreaName" ,"SurveyMethod", "HabitatClassification", "QuadSize_m2", "MADup", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal", "MeanReefDen", "sdReefDen", "semReefDen", "nYearsReef")])
den_avg_reef_nr[, Year := as.integer(Year)]

```

<br><br><br>

#### Only 25-75mm shell height

```{r boxplots-den-25to75mm-nr, echo=TRUE, fig.height=20, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
#Box plots of density by year, by managed area
#oysterraw_den_r_seed_nr[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
oysterraw_den_r_seed_nr[, LD2_HC := paste0(LiveDate2, "_", HabitatClassification)]

Den_NovtoMar_BoxplotByYr_25to75 <- ggplot(oysterraw_den_r_seed_nr, aes(x = LiveDate2, y = meanDen, group = LD2_HC, fill = HabitatClassification)) +
  geom_boxplot() + #color = 'black', fill = 'light blue'
  facet_wrap(~ ManagedAreaName, ncol = 3, scales = 'free') + 
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2012, 2021)) +
  #scale_y_continuous(limits = c(75, 175)) #+
  #coord_cartesian(xlim = c(2007, 2020)) +
  labs(fill = "Habitat Classification")
Den_NovtoMar_BoxplotByYr_25to75

ggsave(here::here(paste0("OA_plots/Den_NovtoMar_BoxplotByYr_25to75_", Sys.Date(), ".jpeg")),
       Den_NovtoMar_BoxplotByYr_25to75,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

```{r AvgDenLive-setup_25to75mm-nr, message=FALSE, warning=FALSE, include=FALSE}
#Density, seed size and by reef
den_avg_seed_all_nr <- oysterraw_den_r_seed_nr[, MeanDen := mean(meanDen), by = c('ManagedAreaName', 'LiveDate2')][, sdDen := sd(meanDen), by = c('LiveDate2', 'ManagedAreaName')][, semDen := sd(meanDen)/sqrt(length(meanDen)), by = c('LiveDate2', 'ManagedAreaName')][, nYears := length(unique(LiveDate2)), by = c('ManagedAreaName')][, MeanReefDen := mean(meanDen), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefDen := sd(meanDen), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefDen := sd(meanDen)/sqrt(length(meanDen)), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef := length(unique(LiveDate2)), by = c('ManagedAreaName', 'reefIDcrosswalk')]
#den_avg_seed_reef_nr <- unique(den_avg_seed_all_nr[, c(1:2, 14, 16:21, 23:25, 27:28, 42:45)])
den_avg_seed_reef_nr <- unique(den_avg_seed_all_nr[, c("ProgramID", "ProgramName", "ManagedAreaName", "SurveyMethod", "HabitatClassification", "MinimumSizeMeasured_mm", "NumberMeasured_n", "QuadSize_m2", "MADup", "reefIDcrosswalk", "LiveDate2", "MA_plotlab", "Region.y", "Subtidal", "MeanReefDen", "sdReefDen", "semReefDen", "nYearsReef")])

```

<br><br><br>

#### Only >75mm shell height

```{r boxplots-den-o75mm-nr, echo=TRUE, fig.height=20, fig.width=10, message=FALSE, warning=FALSE, out.width="100%"}
#Box plots of density by year, by managed area
#oysterraw_den_r_market_nr[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
oysterraw_den_r_market_nr[, LD2_HC := paste0(LiveDate2, "_", HabitatClassification)]

Den_NovtoMar_BoxplotByYr_o75 <- ggplot(oysterraw_den_r_market_nr, aes(x = LiveDate2, y = meanDen, group = LD2_HC, fill = HabitatClassification)) +
  geom_boxplot() + #color = 'black', fill = 'light blue'
  facet_wrap(~ ManagedAreaName, ncol = 3, scales = 'free') + 
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2012, 2021)) +
  #scale_y_continuous(limits = c(75, 175)) #+
  #coord_cartesian(xlim = c(2007, 2020)) +
  labs(fill = "Habitat Classification")
Den_NovtoMar_BoxplotByYr_o75

ggsave(here::here(paste0("OA_plots/Den_NovtoMar_BoxplotByYr_o75_", Sys.Date(), ".jpeg")),
       Den_NovtoMar_BoxplotByYr_o75,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

```{r AvgDenLive-setup_o75mm-nr, message=FALSE, warning=FALSE, include=FALSE}
#Density, market size and by reef
den_avg_market_all_nr <- oysterraw_den_r_market_nr[, MeanDen := mean(meanDen), by = c('ManagedAreaName', 'LiveDate2')][, sdDen := sd(meanDen), by = c('LiveDate2', 'ManagedAreaName')][, semDen := sd(meanDen)/sqrt(length(meanDen)), by = c('LiveDate2', 'ManagedAreaName')][, nYears := length(unique(LiveDate2)), by = c('ManagedAreaName')][, MeanReefDen := mean(meanDen), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefDen := sd(meanDen), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefDen := sd(meanDen)/sqrt(length(meanDen)), by = c('LiveDate2', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef := length(unique(LiveDate2)), by = c('ManagedAreaName', 'reefIDcrosswalk')]
#den_avg_market_reef_nr <- unique(den_avg_market_all_nr[, c(1:2, 14, 16:21, 23:25, 27:28, 42:45)])
den_avg_market_reef_nr <- unique(den_avg_market_all_nr[, c("ProgramID", "ProgramName", "ManagedAreaName", "SurveyMethod", "HabitatClassification", "MinimumSizeMeasured_mm", "NumberMeasured_n", "QuadSize_m2", "MADup", "reefIDcrosswalk", "LiveDate2", "MA_plotlab", "Region.y", "Subtidal", "MeanReefDen", "sdReefDen", "semReefDen", "nYearsReef")])

```

<br><br><br>

***

## Percent live

```{r Percent-live-data-setup-and-summarize-nr, echo=TRUE, message=FALSE, warning=FALSE}

setDT(oysterraw_pct_nr)
oysterraw_pct_nr <- oysterraw_pct_nr %>% mutate(SampleDate = mdy_hms(SampleDate))
oysterraw_pct_nr[, Month := month(SampleDate)]
oysterraw_pct_nr[, YrMo := paste0(Year, "-", Month)]
oysterraw_pct_nr[PercentLiveMethod == "Point-Intercept", PercentLiveMethod := "Point-intercept"]

#Fix QuadID and ReefID columns for 2003 data in program 4014
Reefs_4014_2003 <- c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13')
Quads_4014_2003 <- c('1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '13', '14')
Fix4014 <- oysterraw_pct_nr[ProgramID == 4014, ][Year == 2003, QuadIdentifier := Quads_4014_2003][Year == 2003, ReefIdentifier := Reefs_4014_2003]
no4014 <- subset(oysterraw_pct_nr, oysterraw_pct_nr$ProgramID != 4014)
oysterraw_pct_nr <- rbind(Fix4014, no4014)

#Fix HabitatClassification of 4012
oysterraw_pct_nr[QuadIdentifier %like% "_Ref", HabitatClassification := "Natural"]
oysterraw_pct_nr[QuadIdentifier %like% "_C", HabitatClassification := "Natural"]

#Summarize percent live data by managed area
oysterraw_pct_nona_nr <- subset(oysterraw_pct_nr, !is.na(oysterraw_pct_nr$PercentLive_pct))
oysterraw_pct_nona_nr[, Year := as.integer(Year)]
oysterraw_pct_nona_nr[ProgramID == 4012, PercentLiveMethod := "Percent"]
oysterraw_pct_nona_nr[PercentLiveMethod == "percent", PercentLiveMethod := "Percent"]
pct_all_sum_nr <- setDT(summarySE(oysterraw_pct_nona_nr, measurevar = 'PercentLive_pct', groupvars = c('ManagedAreaName', 'Year', 'PercentLiveMethod')))
```

### Percent live data

<br>

[Click here to view the oyster percent live data file.](https://floridadep.sharepoint.com/:x:/r/fco/seacar/seacar_expert_team/_layouts/15/Doc.aspx?sourcedoc=%7B701B42CD-B462-4464-8F69-FF0EFD6E466F%7D&file=OysterPercentLive_NovtoMar.xlsx&action=default&mobileredirect=true)

```{r Percent-live-data-nr, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, out.width="100%"}

# DT::datatable(oysterraw_pct_nr, filter = 'top', options = list(
#   autoWidth = TRUE, 
#   columnDefs = list(list(width = '200px', targets = c(1))),
#   scrollX = TRUE, 
#   headerCallback = DT::JS(
#     "function(thead) {",
#     "  $(thead).css('font-size', '85%');",
#     "}"
#   )), rownames = FALSE) %>%
#   DT::formatStyle(columns = c(0:19), fontSize = '80%')

write.xlsx(oysterraw_pct_nr, file = here::here("DocsForSMEs/OysterPercentLive_NovtoMar.xlsx"), colNames = TRUE, firstRow = TRUE)

```

<br><br>

### Plot of percent live data availability

```{r PctLive-All-DotPlot-nr, echo=TRUE, message=FALSE, warning=FALSE, out.width="100%"}
#Dot plot showing years with data for each managed area. Dot size corresponds with amount of data.
Pct_NovtoMar_DataAvailability_raw <- ggplot(pct_all_sum_nr, aes(x = Year, y = ManagedAreaName, fill = PercentLiveMethod)) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_point(aes(size = N), color = "black", shape = 21, alpha = 0.5) + #fill = "navy blue",  
  xlim(1950, 2020)
Pct_NovtoMar_DataAvailability_raw

ggsave(here::here(paste0("OA_plots/Pct_NovtoMar_DataAvailability_raw_", Sys.Date(), ".jpeg")),
       Pct_NovtoMar_DataAvailability_raw,
       width = 8,
       height = 6,
       units = "in",
       dpi = 300)
```

<br><br><br>

### Percent live summary table

```{r PctSummaryTable-nr, echo=TRUE, message=FALSE, warning=FALSE}
#Create summary table showing number of reefs/programs of data included in oysterraw_pct_nr
oysterraw_pct_nona_nr[, nReefsbyMAandYr := length(unique(reefIDcrosswalk)), by = c('ManagedAreaName', 'Year')]
oysterraw_pct_nona_nr[, nProgsbyMAandYr := length(unique(ProgramID)), by = c('ManagedAreaName', 'Year')]
oysterraw_pct_nona_nr[, ProgsbyMAandYr := list(list(unique(ProgramID))), by = c('ManagedAreaName', 'Year')]
oysterraw_pct_nona_nr[, nProgsbyMA := length(unique(ProgramID)), by = 'ManagedAreaName']
oysterraw_pct_nona_nr[, ProgsbyMA := list(list(unique(ProgramID))), by = 'ManagedAreaName']

pct_sum1_nr <- unique(oysterraw_pct_nona_nr[, .(ManagedAreaName, Year, nReefsbyMAandYr, nProgsbyMAandYr, nProgsbyMA)], by = c('ManagedAreaName', 'Year', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'nProgsbyMA'))
listcols <- oysterraw_pct_nona_nr[, .SD[1], by = c('ManagedAreaName', 'Year')][, .(ProgsbyMAandYr, ProgsbyMA)]
pct_sum1_nr <- cbind(pct_sum1_nr, listcols)
setcolorder(pct_sum1_nr, c('ManagedAreaName', 'nProgsbyMA', 'ProgsbyMA', 'Year', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'))
setorder(pct_sum1_nr, ManagedAreaName, Year)

#Create easily readable table in knitted document
#Better column names
pct_sum1_renamed_nr <- setnames(pct_sum1_nr, c('nProgsbyMA', 'ProgsbyMA', 'nReefsbyMAandYr', 'nProgsbyMAandYr', 'ProgsbyMAandYr'), c('n progams_tot', 'programs_tot', 'n reefs_yr', 'n programs_yr', 'programs_yr'))

#Group names
groups <- c()
for(i in unique(pct_sum1_nr$ManagedAreaName)){
  name <- paste0(i, ", Total Programs = ", pct_sum1_nr[ManagedAreaName == i, 2][1], ": ", pct_sum1_nr[ManagedAreaName == i, 3][[1]])[1]
  groups <- append(groups, name)
}

#Create the table
pct_sum1_nr[, 4:7] %>% 
  kbl(align = "cccl") %>%
  kable_paper(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, fixed_thead = T) %>%
  #column_spec(1, bold = T) %>%
  # collapse_rows(columns = 1:3, valign = "top") %>%
  pack_rows(index = c("Apalachicola Bay, Total Programs = 1: 4044" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "Apalachicola Bay")$Year), 
                      "Apalachicola NERR, Total Programs = 1: 4044" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "Apalachicola NERR")$Year), 
                      "Boca Ciega Bay, Total Programs = 1: 4020" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "Boca Ciega Bay")$Year), 
                      "Estero Bay, Total Programs = 2: c(4012, 4042)" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "Estero Bay")$Year), 
                      "Guana River Marsh, Total Programs = 1: 4000" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "Guana River Marsh")$Year),  
                      "Guana Tolomato Matanzas NERR, Total Programs = 1: 4000" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "Guana Tolomato Matanzas NERR")$Year), 
                      "Lemon Bay, Total Programs = 1: 972" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "Lemon Bay")$Year), 
                      "Pine Island Sound, Total Programs = 1: 4012" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "Pine Island Sound")$Year),  
                      "Pinellas County, Total Programs = 1: 4020" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "Pinellas County")$Year),  
                      "St. Martins Marsh, Total Programs = 1: 5074" = length(subset(pct_sum1_nr, pct_sum1_nr$ManagedAreaName == "St. Martins Marsh")$Year)),
            label_row_css = "background-color: #666; color: #fff;") %>%
  scroll_box(height = "500px")

```  

<br><br><br>

### Percent live boxplots

```{r PctLivebyYear-boxplots-nr, echo=TRUE, message=FALSE, warning=FALSE, fig.height=20, fig.width=10, out.width="100%"}
#Box plots of percent live by year, by managed area
oysterraw_pct_nona_nr[, MA_plotlab := paste0(ManagedAreaName, "_", HabitatClassification)]
oysterraw_pct_nona_nr[, Yr_PLM := paste0(Year, "_", HabitatClassification)]

Pct_NovtoMar_BoxplotByYr_raw <- ggplot(oysterraw_pct_nona_nr, aes(x = Year, y = PercentLive_pct, group = Yr_PLM, fill = PercentLiveMethod)) +
  geom_boxplot() + #color = 'black', fill = 'light blue'
  facet_wrap(~ MA_plotlab, ncol = 3, scales = 'free') + 
  theme_bw() + theme(axis.line = element_line(), axis.text.x = element_text(angle = 90)) +
  #guides(color = FALSE) +
  scale_x_continuous(limits = c(2006, 2021)) +
  #scale_y_continuous(limits = c(75, 175)) #+
  #coord_cartesian(xlim = c(2007, 2020)) +
  labs(fill = "Percent Live Method")
Pct_NovtoMar_BoxplotByYr_raw

ggsave(here::here(paste0("OA_plots/Pct_NovtoMar_BoxplotByYr_raw_", Sys.Date(), ".jpeg")),
       Pct_NovtoMar_BoxplotByYr_raw,
       width = 10,
       height = 20,
       units = "in",
       dpi = 300)
```

```{r AvgPctLive-setup-nr, echo=TRUE, message=FALSE, warning=FALSE}
#Pct live, all and by reef
pct_avg_all_nr <- oysterraw_pct_nona_nr[, MeanPct := mean(PercentLive_pct), by = c('ManagedAreaName', 'Year')][, sdPct := sd(PercentLive_pct), by = c('Year', 'ManagedAreaName')][, semPct := sd(PercentLive_pct)/sqrt(length(PercentLive_pct)), by = c('Year', 'ManagedAreaName')][, nYears := length(unique(Year)), by = c('ManagedAreaName')][, MeanReefPct := mean(PercentLive_pct), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefPct := sd(PercentLive_pct), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefPct := sd(PercentLive_pct)/sqrt(length(PercentLive_pct)), by = c('Year', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef := length(unique(Year)), by = c('ManagedAreaName', 'reefIDcrosswalk')][, YrMo := format(as.Date(SampleDate), "%Y-%m")][, MeanReefPct_yrmo := mean(PercentLive_pct), by = c('YrMo', 'ManagedAreaName', 'reefIDcrosswalk')][, sdReefPct_yrmo := sd(PercentLive_pct), by = c('YrMo', 'ManagedAreaName', 'reefIDcrosswalk')][, semReefPct_yrmo := sd(PercentLive_pct)/sqrt(length(PercentLive_pct)), by = c('YrMo', 'ManagedAreaName', 'reefIDcrosswalk')][, nYearsReef_yrmo := length(unique(YrMo)), by = c('ManagedAreaName', 'reefIDcrosswalk')]
#pct_avg_reef <- unique(pct_avg_all_nr[, c(1:2, 7:8, 10, 12:16, 21:23, 28:31)])
#pct_avg_reef_yr_nr <- unique(pct_avg_all_nr[, c(1:2, 8, 10, 12:16, 21:24, 30:33)])
#pct_avg_reef_yrmo_nr <- unique(pct_avg_all_nr[, c(1:2, 8, 10, 12:16, 21:23, 34:37)])
pct_avg_reef_yr_nr <- unique(pct_avg_all_nr[, c("ProgramID", "ProgramName", "Year", "ManagedAreaName", "SurveyMethod", "PercentLiveMethod", "HabitatClassification", "QuadSize_m2", "MADup", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal", "MeanReefPct", "sdReefPct", "semReefPct", "nYearsReef")])
pct_avg_reef_yrmo_nr <- unique(pct_avg_all_nr[, c("ProgramID", "ProgramName", "Year", "ManagedAreaName", "SurveyMethod", "PercentLiveMethod", "HabitatClassification", "QuadSize_m2", "MADup", "reefIDcrosswalk", "Region.y", "MA_plotlab", "Subtidal", "MeanReefPct_yrmo", "sdReefPct_yrmo", "semReefPct_yrmo", "nYearsReef_yrmo")])

```

***

<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>